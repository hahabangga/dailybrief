<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>English Listening Practice</title>
  <style>
    body { background:#0f172a; color:#e5e7eb; font-family:system-ui, sans-serif; margin:0; }
    header { padding:16px; border-bottom:1px solid #1f2937; background:#111827; position:sticky; top:0; }
    h1 { margin:0; font-size:20px; }
    .wrap { max-width:900px; margin:0 auto; padding:20px; }
    select,button { margin:4px; padding:6px 10px; border-radius:6px; border:1px solid #334155; background:#1e293b; color:#e5e7eb; }
    .line { padding:6px 0; border-bottom:1px dashed #334155; }
    .ko { color:#a5f3fc; font-size:14px; }
    audio { margin:10px 0; width:100%; }
  </style>
</head>
<body>
<header>
  <h1>🎧 영어 리스닝 연습</h1>
</header>

<div class="wrap">
  <div>
    <label>스토리 선택: </label>
    <select id="storySel"></select>
    <button onclick="playAll()">▶ 전체 재생</button>
  </div>
  <div>
    <label>보기 모드: </label>
    <button onclick="setViewMode('en')">영어만</button>
    <button onclick="setViewMode('line')">영어+한글</button>
    <button onclick="setViewMode('sep')">영어 따로/한글 따로</button>
  </div>
  <div style="margin:10px 0">
    <label>음성 선택: </label>
    <select id="voiceSel"></select>
    <label>속도: <input type="number" id="rate" value="1" step="0.1" style="width:60px"/></label>
  </div>
  <div id="scriptArea"></div>
</div>

<script>
const LIB = [
  {
    id:'fairy1',
    title:'The Little Cat (동화)',
    lines:[
      { en:'The little cat is in the garden.', ko:'작은 고양이가 정원에 있어요.' },
      { en:'It sees a butterfly.', ko:'나비를 봐요.' },
      { en:'The cat runs and jumps.', ko:'고양이가 달리고 점프해요.' },
      { en:'The butterfly flies away.', ko:'나비가 날아가 버려요.' },
      { en:'The cat sits and looks at the sky.', ko:'고양이는 앉아서 하늘을 바라봐요.' }
    ]
  },
  {
    id:'fairy2',
    title:'A Sunny Day (동화)',
    lines:[
      { en:'Today is a sunny day.', ko:'오늘은 화창한 날이에요.' },
      { en:'The children play in the park.', ko:'아이들이 공원에서 놀아요.' },
      { en:'They run with a ball.', ko:'그들은 공을 가지고 달려요.' },
      { en:'They eat ice cream.', ko:'그들은 아이스크림을 먹어요.' },
      { en:'Everyone is happy.', ko:'모두가 행복해요.' }
    ]
  },
  {
    id:'toeic1',
    title:'At the Office (토익600수준)',
    lines:[
      { en:'The manager asked me to prepare the report by tomorrow.', ko:'부장님이 내일까지 보고서를 준비하라고 했습니다.' },
      { en:'I will need to check the data and update the figures.', ko:'나는 데이터를 확인하고 수치를 업데이트해야 합니다.' },
      { en:'After that, we will have a short meeting.', ko:'그 후에 우리는 짧은 회의를 할 것입니다.' }
    ]
  }
];

let currentSet = LIB[0];
let viewMode = 'line'; // 기본 모드
let voices=[];

// 초기화
const sel=document.getElementById('storySel');
LIB.forEach((s,i)=>{ const opt=document.createElement('option'); opt.value=i; opt.textContent=s.title; sel.appendChild(opt); });
sel.onchange=()=>{ currentSet=LIB[sel.value]; renderScript(); };

function setViewMode(m){ viewMode=m; renderScript(); }

function renderScript(){
  let html='';
  if(viewMode==='en'){
    html = currentSet.lines.map((l,i)=>`<div class="line" onclick="playLine(${i})">${l.en}</div>`).join('');
  } else if(viewMode==='line'){
    html = currentSet.lines.map((l,i)=>`<div class="line" onclick="playLine(${i})">${l.en}<br/><span class="ko">${l.ko}</span></div>`).join('');
  } else if(viewMode==='sep'){
    html = `<h3>English</h3>`+currentSet.lines.map((l,i)=>`<div class="line" onclick="playLine(${i})">${l.en}</div>`).join('')
         + `<h3>Korean</h3>`+currentSet.lines.map(l=>`<div class="line">${l.ko}</div>`).join('');
  }
  document.getElementById('scriptArea').innerHTML=html;
}
renderScript();

// TTS
function loadVoices(){
  voices = speechSynthesis.getVoices();
  const vs=document.getElementById('voiceSel');
  vs.innerHTML='';
  voices.forEach((v,i)=>{
    if(v.lang.startsWith('en')){ 
      const opt=document.createElement('option'); 
      opt.value=i; opt.textContent=v.name+' ('+v.lang+')'; 
      vs.appendChild(opt); 
    }
  });
}
speechSynthesis.onvoiceschanged=loadVoices; loadVoices();

function playLine(i){
  const rate=parseFloat(document.getElementById('rate').value)||1;
  const vsel=document.getElementById('voiceSel'); 
  const voice=voices[vsel.value];
  const u=new SpeechSynthesisUtterance(currentSet.lines[i].en);
  if(voice) u.voice=voice;
  u.rate=rate;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

function playAll(){
  const rate=parseFloat(document.getElementById('rate').value)||1;
  const vsel=document.getElementById('voiceSel'); 
  const voice=voices[vsel.value];
  speechSynthesis.cancel();
  currentSet.lines.forEach((l,idx)=>{
    const u=new SpeechSynthesisUtterance(l.en);
    if(voice) u.voice=voice;
    u.rate=rate;
    speechSynthesis.speak(u);
  });
}
</script>
</body>
</html>
