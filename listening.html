<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì˜ì–´ ë¦¬ìŠ¤ë‹ ìŠ¤í„°ë””</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8; --accent:#38bdf8; --good:#34d399; --warn:#fbbf24; }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",Helvetica,Arial,"Apple SD Gothic Neo","Malgun Gothic",sans-serif;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(15,23,42,.98),rgba(15,23,42,.92));border-bottom:1px solid #1f2937;padding:14px 16px}
    header .nav{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    header a{color:var(--accent);text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:18px;display:grid;gap:14px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:16px;box-shadow:0 10px 24px rgba(0,0,0,.25)}
    .card h2{margin:0 0 10px;font-size:18px}
    .muted{color:var(--muted);font-size:13px}
    select,input[type="range"],button{background:#0b1220;color:var(--text);border:1px solid #223046;border-radius:10px}
    select{padding:8px 10px}
    input[type="range"]{width:160px}
    button{padding:8px 12px;cursor:pointer}
    .ctrls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .pill{display:inline-block;padding:2px 8px;border:1px solid #334155;border-radius:999px;font-size:12px;color:#a5b4fc}
    .script{list-style:none;margin:0;padding:0}
    .line{padding:10px;border-top:1px dashed #223046}
    .line:first-child{border-top:none}
    .en{font-size:16px;line-height:1.5}
    .ko{color:#a5f3fc;margin-top:6px;display:none}
    .grammar,.vocab{color:#cbd5e1;margin-top:6px;display:none;font-size:14px}
    .vocab ul{list-style:disc;margin:6px 0 0 18px}
    .line.playing{background:#0b1220;border-left:3px solid var(--accent)}
    .badgetag{display:inline-block;margin-left:6px;font-size:11px;color:#eab308;border:1px solid #56411a;padding:0 6px;border-radius:999px}
    .tools{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .recStatus{font-size:12px}
    .hint{font-size:12px;color:#9ca3af}
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <strong>ğŸ—£ ì˜ì–´ ë¦¬ìŠ¤ë‹ ìŠ¤í„°ë””</strong>
      <span class="muted">TOEIC 600 Â± ìˆ˜ì¤€</span>
      <span class="pill">í´ë¼ì´ì–¸íŠ¸ ì „ìš© Â· ë¬´ë£Œ</span>
      <span style="flex:1"></span>
      <a href="index.html">â† ë°ì¼ë¦¬ ë¸Œë¦¬í•‘</a>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <h2>ì½˜í…ì¸  ì„ íƒ & ì¬ìƒ ì„¤ì •</h2>
      <div class="ctrls">
        <label class="muted">ìŠ¤í† ë¦¬</label>
        <select id="storySel"></select>
        <label class="muted">ì†ë„</label>
        <input id="rate" type="range" min="0.6" max="1.2" step="0.05" value="0.9" />
        <span id="rateVal" class="muted">0.90Ã—</span>
        <label class="muted">ëª©ì†Œë¦¬</label>
        <select id="voiceSel"></select>
        <button id="btnPlayAll">â–¶ ì „ì²´ì¬ìƒ</button>
        <button id="btnPause">â¸ ì¼ì‹œì •ì§€</button>
        <button id="btnResume">â¯ ì¬ê°œ</button>
        <button id="btnStop">â¹ ì •ì§€</button>
      </div>
      <div class="tools">
        <button id="toggleKo">ë²ˆì—­ ë³´ê¸°/ìˆ¨ê¸°ê¸°</button>
        <button id="toggleGrammar">ë¬¸ë²• ë³´ê¸°/ìˆ¨ê¸°ê¸°</button>
        <button id="toggleVocab">ë‹¨ì–´ ë³´ê¸°/ìˆ¨ê¸°ê¸°</button>
        <button id="btnShadow">ğŸ¤ ì‰ë„ì‰ ë…¹ìŒ</button>
        <span id="recStat" class="recStatus muted">ëŒ€ë¶€ë¶„ì˜ ë°ìŠ¤í¬í†± ë¸Œë¼ìš°ì €ì—ì„œ ë™ì‘</span>
      </div>
      <div class="hint">ë¬¸ì¥ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ë¬¸ì¥ë§Œ ì¬ìƒë©ë‹ˆë‹¤. ì–´ë ¤ìš´ ë¬¸ì¥ì—ëŠ” <span class="badgetag">Grammar</span> íƒœê·¸ê°€ ë‹¬ë ¤ ìˆì–´ìš”.</div>
    </section>

    <section class="card">
      <h2 id="storyTitle">ìŠ¤í¬ë¦½íŠ¸</h2>
      <ul id="script" class="script"></ul>
    </section>
  </main>

  <script>
    // ===== ë°ì´í„°: A2~B1 (TOEIC ì•½ 500~650) ë‚œì´ë„ =====
    const LIB = [
      {
        id:'easy-picnic',
        title:'EASY Â· The Park Picnic',
        level:'A2',
        lines:[
          {en:'Mina packs sandwiches and fruit for a picnic.', ko:'ë¯¸ë‚˜ëŠ” í”¼í¬ë‹‰ì„ ìœ„í•´ ìƒŒë“œìœ„ì¹˜ì™€ ê³¼ì¼ì„ ì±™ê¸´ë‹¤.', grammar:'í˜„ì¬ì‹œì œ ì¼ë°˜ë¬¸. pack A for B: Bë¥¼ ìœ„í•´ Aë¥¼ ì±™ê¸°ë‹¤.', vocab:[['pack','ì±™ê¸°ë‹¤'],['picnic','ì†Œí’']]},
          {en:'The sky is clear, but the grass is wet.', ko:'í•˜ëŠ˜ì€ ë§‘ì§€ë§Œ, ì”ë””ëŠ” ì –ì–´ ìˆë‹¤.', grammar:'ë“±ìœ„ì ‘ì†ì‚¬ but ëŒ€ì¡°. ë³´ì–´ í˜•ìš©ì‚¬ clear / wet.', vocab:[['clear','ë§‘ì€'],['grass','ì”ë””']]},
          {en:'They spread a blanket and sit down carefully.', ko:'ê·¸ë“¤ì€ ë‹´ìš”ë¥¼ í´ê³  ì¡°ì‹¬íˆ ì•‰ëŠ”ë‹¤.', grammar:'ë™ì‚¬ì—´ê±° spread ~ and sit down. ë¶€ì‚¬ carefully ìš©ë²•.', vocab:[['spread','í¼ì¹˜ë‹¤'],['blanket','ë‹´ìš”']]},
          {en:'A curious squirrel comes close, looking for crumbs.', ko:'í˜¸ê¸°ì‹¬ ë§ì€ ë‹¤ëŒì¥ê°€ ê°€ê¹Œì´ ì™€ì„œ ë¹µë¶€ìŠ¤ëŸ¬ê¸°ë¥¼ ì°¾ëŠ”ë‹¤.', grammar:'ë¶„ì‚¬êµ¬ë¬¸: comes close, looking for ~.', vocab:[['curious','í˜¸ê¸°ì‹¬ ë§ì€'],['crumb','ë¶€ìŠ¤ëŸ¬ê¸°']]},
          {en:'Mina laughs and gives it a tiny piece of apple.', ko:'ë¯¸ë‚˜ëŠ” ì›ƒìœ¼ë©° ì‚¬ê³¼ ì¡°ê°ì„ ì¡°ê¸ˆ ì¤€ë‹¤.', grammar:'give + ê°„ì ‘ëª©ì ì–´(it) + ì§ì ‘ëª©ì ì–´(a piece).', vocab:[['tiny','ì•„ì£¼ ì‘ì€'],['piece','ì¡°ê°']]}
        ]
      },
      {
        id:'toeic600-delivery',
        title:'CORE Â· The Late Delivery',
        level:'A2~B1',
        lines:[
          {en:'The customer placed an online order last Friday, but the package has not arrived yet.', ko:'ê³ ê°ì€ ì§€ë‚œ ê¸ˆìš”ì¼ì— ì˜¨ë¼ì¸ ì£¼ë¬¸ì„ í–ˆì§€ë§Œ, ì†Œí¬ëŠ” ì•„ì§ ë„ì°©í•˜ì§€ ì•Šì•˜ë‹¤.', grammar:'ëŒ€ê³¼ê±°/í˜„ì¬ì™„ë£Œ ëŒ€ë¹„: placed(ê³¼ê±°) vs has not arrived yet(í˜„ì¬ì™„ë£Œ ë¶€ì •).', vocab:[['place an order','ì£¼ë¬¸í•˜ë‹¤'],['arrive','ë„ì°©í•˜ë‹¤']]},
          {en:'Mina checks the tracking number and sees a delay notice.', ko:'ë¯¸ë‚˜ëŠ” ìš´ì†¡ì¥ ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ê³  ì§€ì—° ê³µì§€ë¥¼ ë³¸ë‹¤.', grammar:'andë¡œ ë™ì‚¬ ì—°ê²°. see + ëª©ì ì–´.', vocab:[['tracking number','ìš´ì†¡ì¥ ë²ˆí˜¸'],['delay notice','ì§€ì—° ê³µì§€']]},
          {en:'She emails the warehouse to confirm the status and asks for a revised delivery date.', ko:'ê·¸ë…€ëŠ” ì°½ê³  ì¸¡ì— ìƒíƒœ í™•ì¸ ë©”ì¼ì„ ë³´ë‚´ê³ , ë³€ê²½ëœ ë°°ì†¡ ë‚ ì§œë¥¼ ìš”ì²­í•œë‹¤.', grammar:'toë¶€ì •ì‚¬ ëª©ì : to confirm / for a revised date(ëª…ì‚¬êµ¬).', vocab:[['warehouse','ì°½ê³ '],['revised','ìˆ˜ì •ëœ']]},
          {en:'The manager apologizes and offers a small discount on the next purchase.', ko:'ë§¤ë‹ˆì €ëŠ” ì‚¬ê³¼í•˜ê³  ë‹¤ìŒ êµ¬ë§¤ì— ì†Œì•¡ í• ì¸ ì œê³µì„ ì œì•ˆí•œë‹¤.', grammar:'andë¡œ ë™ì‚¬ ì—°ê²°. offer A on B: Bì— ëŒ€í•´ Aë¥¼ ì œê³µí•˜ë‹¤.', vocab:[['apologize','ì‚¬ê³¼í•˜ë‹¤'],['discount','í• ì¸']]},
          {en:'Mina updates the customer politely and attaches the new schedule.', ko:'ë¯¸ë‚˜ëŠ” ê³ ê°ì—ê²Œ ì •ì¤‘íˆ ìƒí™©ì„ ì—…ë°ì´íŠ¸í•˜ê³  ìƒˆ ì¼ì •ì„ ì²¨ë¶€í•œë‹¤.', grammar:'ë¶€ì‚¬ politelyì˜ ìœ„ì¹˜. attach + ëª©ì ì–´.', vocab:[['politely','ì •ì¤‘í•˜ê²Œ'],['attach','ì²¨ë¶€í•˜ë‹¤']]},
          {en:'Although the delay was inconvenient, the clear communication reduced the complaint.', ko:'ì§€ì—°ì´ ë¶ˆí¸í–ˆì§€ë§Œ, ëª…í™•í•œ ì†Œí†µì´ ë¶ˆë§Œì„ ì¤„ì˜€ë‹¤.', grammar:'ì–‘ë³´ì ˆ Although ~, ì£¼ì ˆ ~. reduce ëª©ì ì–´.', vocab:[['although','ë¹„ë¡ ~ì´ì§€ë§Œ'],['reduce','ì¤„ì´ë‹¤']]}
        ]
      },
      {
        id:'news-lite-townhall',
        title:'PLUS Â· A Company Town Hall',
        level:'B1',
        lines:[
          {en:'The CEO opened the town hall by thanking the staff for their resilience.', ko:'CEOëŠ” ì§ì›ë“¤ì˜ ëˆê¸°ì— ê°ì‚¬ë¥¼ í‘œí•˜ë©° íƒ€ìš´í™€ ë¯¸íŒ…ì„ ì‹œì‘í–ˆë‹¤.', grammar:'ë™ëª…ì‚¬êµ¬ by thanking ~ (ìˆ˜ë‹¨ì„ ë‚˜íƒ€ë‚´ëŠ” by + ë™ëª…ì‚¬).', vocab:[['resilience','íšŒë³µíƒ„ë ¥ì„±'],['town hall','ì „ì²´ íšŒì˜']]},
          {en:'She outlined three goals: improving service speed, cutting costs, and expanding to new markets.', ko:'ê·¸ë…€ëŠ” ì„¸ ê°€ì§€ ëª©í‘œë¥¼ ì„¤ëª…í–ˆë‹¤: ì„œë¹„ìŠ¤ ì†ë„ í–¥ìƒ, ë¹„ìš© ì ˆê°, ì‹ ì‹œì¥ í™•ëŒ€.', grammar:'ë³‘ë ¬ êµ¬ì¡°: improving / cutting / expanding(ë™ëª…ì‚¬ ë³‘ë ¬).', vocab:[['outline','ê°œìš”ë¥¼ ë§í•˜ë‹¤'],['expand','í™•ì¥í•˜ë‹¤']]},
          {en:'Employees submitted questions anonymously through an online form.', ko:'ì§ì›ë“¤ì€ ì˜¨ë¼ì¸ ì–‘ì‹ì„ í†µí•´ ìµëª…ìœ¼ë¡œ ì§ˆë¬¸ì„ ì œì¶œí–ˆë‹¤.', grammar:'ë¶€ì‚¬ anonymously. ì „ì¹˜ì‚¬êµ¬ through an online form.', vocab:[['anonymously','ìµëª…ìœ¼ë¡œ'],['submit','ì œì¶œí•˜ë‹¤']]},
          {en:'Some concerns were specific, but most focused on workload and career growth.', ko:'ì¼ë¶€ ìš°ë ¤ëŠ” êµ¬ì²´ì ì´ì—ˆì§€ë§Œ, ëŒ€ë¶€ë¶„ì€ ì—…ë¬´ëŸ‰ê³¼ ê²½ë ¥ ì„±ì¥ì— ì§‘ì¤‘í–ˆë‹¤.', grammar:'ëŒ€ì¡° but, ë³‘ë ¬ focused on A and B.', vocab:[['concern','ìš°ë ¤'],['workload','ì—…ë¬´ëŸ‰']]}
        ]
      }
    ];

    // ===== ìƒíƒœ =====
    const els = {
      storySel: document.getElementById('storySel'),
      voiceSel: document.getElementById('voiceSel'),
      rate: document.getElementById('rate'),
      rateVal: document.getElementById('rateVal'),
      script: document.getElementById('script'),
      storyTitle: document.getElementById('storyTitle'),
      btnPlayAll: document.getElementById('btnPlayAll'),
      btnPause: document.getElementById('btnPause'),
      btnResume: document.getElementById('btnResume'),
      btnStop: document.getElementById('btnStop'),
      toggleKo: document.getElementById('toggleKo'),
      toggleGrammar: document.getElementById('toggleGrammar'),
      toggleVocab: document.getElementById('toggleVocab'),
      btnShadow: document.getElementById('btnShadow'),
      recStat: document.getElementById('recStat')
    };

    // ===== ìŒì„± í•©ì„±(ë¸Œë¼ìš°ì € TTS) =====
    const synth = window.speechSynthesis;
    let VOICES = [];
    function loadVoices(){ VOICES = synth.getVoices().filter(v=>/en|US|GB/i.test(v.lang)); renderVoices(); }
    function renderVoices(){
      els.voiceSel.innerHTML = VOICES.map((v,i)=>`<option value="${i}">${v.name} (${v.lang})</option>`).join('');
      const saved = localStorage.getItem('tts_voice_idx');
      if(saved && VOICES[saved]) els.voiceSel.value = saved;
    }
    window.speechSynthesis.onvoiceschanged = loadVoices; // í¬ë¡¬ ì´ˆê¸° ë¡œë”© ëŒ€ì‘
    loadVoices();

    function speakText(text){
      return new Promise((resolve)=>{
        const u = new SpeechSynthesisUtterance(text);
        const idx = parseInt(els.voiceSel.value||0,10);
        if(VOICES[idx]) u.voice = VOICES[idx];
        u.rate = parseFloat(els.rate.value||0.9);
        u.onend = resolve; u.onerror = resolve; // ì‹¤íŒ¨í•´ë„ ë‹¤ìŒìœ¼ë¡œ
        synth.speak(u);
      });
    }

    // ===== ë Œë”ë§ =====
    function renderStory(st){
      els.storyTitle.textContent = `ìŠ¤í¬ë¦½íŠ¸ â€” ${st.title} (Level ${st.level})`;
      els.script.innerHTML = st.lines.map((ln,i)=>{
        const hard = (ln.grammar && /although|which|that|because|while|subjunctive|inverted/i.test(ln.grammar)) ? '<span class="badgetag">Grammar</span>' : '';
        const vocabHtml = (ln.vocab||[]).map(([w,m])=>`<li>â€¢ <b>${w}</b>: ${m}</li>`).join('');
        return `<li class="line" data-idx="${i}">
          <div class="en">${ln.en} ${hard}</div>
          <div class="ko">${ln.ko}</div>
          <div class="grammar">ë¬¸ë²•: ${ln.grammar||'â€”'}</div>
          <div class="vocab"><div>ë‹¨ì–´</div><ul>${vocabHtml}</ul></div>
        </li>`;
      }).join('');
    }

    // ===== ìŠ¤í† ë¦¬ ì„ íƒ/ì €ì¥ =====
    function renderStoryOptions(){
      els.storySel.innerHTML = LIB.map((s,i)=>`<option value="${i}">${s.title}</option>`).join('');
      const saved = localStorage.getItem('story_idx');
      els.storySel.value = saved || '1'; // ê¸°ë³¸: TOEIC 600 ì½”ì–´
      renderStory(LIB[parseInt(els.storySel.value,10)]);
    }
    renderStoryOptions();

    els.storySel.addEventListener('change',()=>{
      localStorage.setItem('story_idx', els.storySel.value);
      renderStory(LIB[parseInt(els.storySel.value,10)]);
    });

    els.rate.addEventListener('input',()=>{
      els.rateVal.textContent = parseFloat(els.rate.value).toFixed(2)+'Ã—';
      localStorage.setItem('tts_rate', els.rate.value);
    });
    const savedRate = localStorage.getItem('tts_rate');
    if(savedRate){ els.rate.value = savedRate; els.rate.dispatchEvent(new Event('input')); }

    els.voiceSel.addEventListener('change',()=>{
      localStorage.setItem('tts_voice_idx', els.voiceSel.value);
    });

    // ===== í† ê¸€ í‘œì‹œ =====
    let showKo=false, showG=false, showV=false;
    function applyToggles(){
      document.querySelectorAll('.ko').forEach(e=>e.style.display = showKo? 'block':'none');
      document.querySelectorAll('.grammar').forEach(e=>e.style.display = showG? 'block':'none');
      document.querySelectorAll('.vocab').forEach(e=>e.style.display = showV? 'block':'none');
    }
    els.toggleKo.addEventListener('click',()=>{ showKo=!showKo; applyToggles(); });
    els.toggleGrammar.addEventListener('click',()=>{ showG=!showG; applyToggles(); });
    els.toggleVocab.addEventListener('click',()=>{ showV=!showV; applyToggles(); });

    // ===== ì¬ìƒ ì œì–´ =====
    let playingIdx = -1; let stopAll=false;
    function highlight(idx){
      document.querySelectorAll('.line').forEach(li=>li.classList.remove('playing'));
      const el = document.querySelector(`.line[data-idx="${idx}"]`);
      if(el) el.classList.add('playing');
    }

    async function playAll(){
      stopAll=false;
      const lines = LIB[parseInt(els.storySel.value,10)].lines;
      for(let i=0;i<lines.length;i++){
        if(stopAll) break;
        playingIdx=i; highlight(i);
        await speakText(lines[i].en);
      }
      playingIdx=-1; highlight(-1);
    }

    els.btnPlayAll.addEventListener('click',playAll);
    els.btnPause.addEventListener('click',()=>{ if(synth.speaking && !synth.paused) synth.pause(); });
    els.btnResume.addEventListener('click',()=>{ if(synth.paused) synth.resume(); });
    els.btnStop.addEventListener('click',()=>{ stopAll=true; synth.cancel(); highlight(-1); });

    // ë¬¸ì¥ í´ë¦­ ì¬ìƒ
    els.script.addEventListener('click',(e)=>{
      const li = e.target.closest('.line'); if(!li) return;
      const idx = parseInt(li.dataset.idx,10);
      stopAll=true; synth.cancel();
      playingIdx=idx; highlight(idx);
      const ln = LIB[parseInt(els.storySel.value,10)].lines[idx];
      speakText(ln.en).then(()=>highlight(-1));
    });

    // ===== ì‰ë„ì‰ ë…¹ìŒ(ì„ íƒ) =====
    let mediaRecorder; let chunks=[]; let recording=false;
    async function toggleRecord(){
      try{
        if(!recording){
          const stream = await navigator.mediaDevices.getUserMedia({audio:true});
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.ondataavailable = e=>{ if(e.data.size>0) chunks.push(e.data); };
          mediaRecorder.onstop = ()=>{
            const blob = new Blob(chunks,{type:'audio/webm'}); chunks=[];
            const url = URL.createObjectURL(blob);
            const a = document.createElement('audio'); a.controls=true; a.src=url; a.style.display='block'; a.style.marginTop='8px';
            document.querySelector('.card:last-of-type').appendChild(a);
          };
          mediaRecorder.start(); recording=true; els.recStat.textContent='ë…¹ìŒ ì¤‘â€¦ (ë‹¤ì‹œ ëˆ„ë¥´ë©´ ì¢…ë£Œ)';
        }else{
          mediaRecorder.stop(); recording=false; els.recStat.textContent='ì €ì¥ ì™„ë£Œ. ì•„ë˜ ì˜¤ë””ì˜¤ë¡œ ì¬ìƒ ê°€ëŠ¥';
        }
      }catch(err){ els.recStat.textContent='ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.'; }
    }
    els.btnShadow.addEventListener('click', toggleRecord);

    // ì´ˆê¸° ìƒíƒœ ì ìš©
    applyToggles();
  </script>
</body>
</html>
