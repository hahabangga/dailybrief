<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>English Listening Practice</title>
  <style>
    body { background:#0f172a; color:#e5e7eb; font-family:system-ui, sans-serif; margin:0; }
    header { padding:16px; border-bottom:1px solid #1f2937; background:#111827; position:sticky; top:0; }
    h1 { margin:0; font-size:20px; }
    .wrap { max-width:900px; margin:0 auto; padding:20px; }
    select,button { margin:4px; padding:6px 10px; border-radius:6px; border:1px solid #334155; background:#1e293b; color:#e5e7eb; }
    .line { padding:6px 0; border-bottom:1px dashed #334155; }
    .ko { color:#a5f3fc; font-size:14px; }
    audio { margin:10px 0; width:100%; }
  </style>
</head>
<body>
<header>
  <h1>ğŸ§ ì˜ì–´ ë¦¬ìŠ¤ë‹ ì—°ìŠµ</h1>
</header>

<div class="wrap">
  <div>
    <label>ìŠ¤í† ë¦¬ ì„ íƒ: </label>
    <select id="storySel"></select>
    <button onclick="playAll()">â–¶ ì „ì²´ ì¬ìƒ</button>
  </div>
  <div>
    <label>ë³´ê¸° ëª¨ë“œ: </label>
    <button onclick="setViewMode('en')">ì˜ì–´ë§Œ</button>
    <button onclick="setViewMode('line')">ì˜ì–´+í•œê¸€</button>
    <button onclick="setViewMode('sep')">ì˜ì–´ ë”°ë¡œ/í•œê¸€ ë”°ë¡œ</button>
  </div>
  <div style="margin:10px 0">
    <label>ìŒì„± ì„ íƒ: </label>
    <select id="voiceSel"></select>
    <label>ì†ë„: <input type="number" id="rate" value="1" step="0.1" style="width:60px"/></label>
  </div>
  <div id="scriptArea"></div>
</div>

<script>
const LIB = [
  {
    id:'fairy1',
    title:'The Little Cat (ë™í™”)',
    lines:[
      { en:'The little cat is in the garden.', ko:'ì‘ì€ ê³ ì–‘ì´ê°€ ì •ì›ì— ìˆì–´ìš”.' },
      { en:'It sees a butterfly.', ko:'ë‚˜ë¹„ë¥¼ ë´ìš”.' },
      { en:'The cat runs and jumps.', ko:'ê³ ì–‘ì´ê°€ ë‹¬ë¦¬ê³  ì í”„í•´ìš”.' },
      { en:'The butterfly flies away.', ko:'ë‚˜ë¹„ê°€ ë‚ ì•„ê°€ ë²„ë ¤ìš”.' },
      { en:'The cat sits and looks at the sky.', ko:'ê³ ì–‘ì´ëŠ” ì•‰ì•„ì„œ í•˜ëŠ˜ì„ ë°”ë¼ë´ìš”.' }
    ]
  },
  {
    id:'fairy2',
    title:'A Sunny Day (ë™í™”)',
    lines:[
      { en:'Today is a sunny day.', ko:'ì˜¤ëŠ˜ì€ í™”ì°½í•œ ë‚ ì´ì—ìš”.' },
      { en:'The children play in the park.', ko:'ì•„ì´ë“¤ì´ ê³µì›ì—ì„œ ë†€ì•„ìš”.' },
      { en:'They run with a ball.', ko:'ê·¸ë“¤ì€ ê³µì„ ê°€ì§€ê³  ë‹¬ë ¤ìš”.' },
      { en:'They eat ice cream.', ko:'ê·¸ë“¤ì€ ì•„ì´ìŠ¤í¬ë¦¼ì„ ë¨¹ì–´ìš”.' },
      { en:'Everyone is happy.', ko:'ëª¨ë‘ê°€ í–‰ë³µí•´ìš”.' }
    ]
  },
  {
    id:'toeic1',
    title:'At the Office (í† ìµ600ìˆ˜ì¤€)',
    lines:[
      { en:'The manager asked me to prepare the report by tomorrow.', ko:'ë¶€ì¥ë‹˜ì´ ë‚´ì¼ê¹Œì§€ ë³´ê³ ì„œë¥¼ ì¤€ë¹„í•˜ë¼ê³  í–ˆìŠµë‹ˆë‹¤.' },
      { en:'I will need to check the data and update the figures.', ko:'ë‚˜ëŠ” ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³  ìˆ˜ì¹˜ë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.' },
      { en:'After that, we will have a short meeting.', ko:'ê·¸ í›„ì— ìš°ë¦¬ëŠ” ì§§ì€ íšŒì˜ë¥¼ í•  ê²ƒì…ë‹ˆë‹¤.' }
    ]
  }
];

let currentSet = LIB[0];
let viewMode = 'line'; // ê¸°ë³¸ ëª¨ë“œ
let voices=[];

// ì´ˆê¸°í™”
const sel=document.getElementById('storySel');
LIB.forEach((s,i)=>{ const opt=document.createElement('option'); opt.value=i; opt.textContent=s.title; sel.appendChild(opt); });
sel.onchange=()=>{ currentSet=LIB[sel.value]; renderScript(); };

function setViewMode(m){ viewMode=m; renderScript(); }

function renderScript(){
  let html='';
  if(viewMode==='en'){
    html = currentSet.lines.map((l,i)=>`<div class="line" onclick="playLine(${i})">${l.en}</div>`).join('');
  } else if(viewMode==='line'){
    html = currentSet.lines.map((l,i)=>`<div class="line" onclick="playLine(${i})">${l.en}<br/><span class="ko">${l.ko}</span></div>`).join('');
  } else if(viewMode==='sep'){
    html = `<h3>English</h3>`+currentSet.lines.map((l,i)=>`<div class="line" onclick="playLine(${i})">${l.en}</div>`).join('')
         + `<h3>Korean</h3>`+currentSet.lines.map(l=>`<div class="line">${l.ko}</div>`).join('');
  }
  document.getElementById('scriptArea').innerHTML=html;
}
renderScript();

// TTS
function loadVoices(){
  voices = speechSynthesis.getVoices();
  const vs=document.getElementById('voiceSel');
  vs.innerHTML='';
  voices.forEach((v,i)=>{
    if(v.lang.startsWith('en')){ 
      const opt=document.createElement('option'); 
      opt.value=i; opt.textContent=v.name+' ('+v.lang+')'; 
      vs.appendChild(opt); 
    }
  });
}
speechSynthesis.onvoiceschanged=loadVoices; loadVoices();

function playLine(i){
  const rate=parseFloat(document.getElementById('rate').value)||1;
  const vsel=document.getElementById('voiceSel'); 
  const voice=voices[vsel.value];
  const u=new SpeechSynthesisUtterance(currentSet.lines[i].en);
  if(voice) u.voice=voice;
  u.rate=rate;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

function playAll(){
  const rate=parseFloat(document.getElementById('rate').value)||1;
  const vsel=document.getElementById('voiceSel'); 
  const voice=voices[vsel.value];
  speechSynthesis.cancel();
  currentSet.lines.forEach((l,idx)=>{
    const u=new SpeechSynthesisUtterance(l.en);
    if(voice) u.voice=voice;
    u.rate=rate;
    speechSynthesis.speak(u);
  });
}
</script>
</body>
</html>
