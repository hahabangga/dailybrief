<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Briefing</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8; --accent:#38bdf8; }
    * { box-sizing:border-box }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Helvetica, Arial, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; background:var(--bg); color:var(--text); }
    header { padding:20px; border-bottom:1px solid #1f2937; position:sticky; top:0; background:linear-gradient(180deg, rgba(15,23,42,.98), rgba(15,23,42,.92)); backdrop-filter: blur(6px); z-index:10; }
    h1 { margin:0; font-size:22px; letter-spacing:.3px; }
    .sub { color:var(--muted); font-size:14px; margin-top:6px }
    .wrap { max-width:1100px; margin:0 auto; padding:22px; display:grid; grid-template-columns: 1fr; gap:18px }
    @media (min-width: 980px) { .wrap { grid-template-columns: 1.1fr 1fr; } }
    .card { background:var(--card); border:1px solid #1f2937; border-radius:16px; padding:16px 16px 14px; box-shadow: 0 10px 24px rgba(0,0,0,.25); }
    .card h2 { margin:0 0 10px; font-size:18px; }
    .row { display:flex; gap:10px; flex-wrap:wrap }
    .muted { color:var(--muted); font-size:13px }
    .kpi { display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px }
    .kpi .tile { background:#0b1220; border:1px solid #1f2937; padding:10px 12px; border-radius:12px; }
    .tile .label { color:#9CA3AF; font-size:12px }
    .tile .value { font-size:16px; margin-top:4px }
    .list { list-style:none; padding:0; margin:0 }
    .list li { padding:8px 0; border-top:1px dashed #223046; }
    .list li:first-child { border-top:none }
    a { color: var(--accent); text-decoration:none }
    .inputline { display:flex; gap:8px; align-items:center; margin-bottom:10px }
    input, select { background:#0b1220; color:var(--text); border:1px solid #223046; padding:8px 10px; border-radius:10px }
    button { background:#0ea5e9; color:white; border:0; padding:8px 12px; border-radius:10px; cursor:pointer }
    .foot { text-align:center; color:#778; font-size:12px; padding:14px }
    .tvwrap { border-radius:12px; overflow:hidden; border:1px solid #223046; }
    .pill { display:inline-block; padding:2px 8px; border:1px solid #334155; border-radius:999px; font-size:12px; color:#a5b4fc; }
    .grid2 { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px }
  </style>
</head>
<body>
<header>
  <h1>ì˜¤ëŠ˜ì˜ ë¸Œë¦¬í•‘</h1>
  <div class="sub" id="todayStr">ë¡œë”© ì¤‘â€¦</div>
</header>

<div class="wrap">
  <!-- Left column -->
  <section class="card">
    <h2>â˜€ï¸ ì˜¤ëŠ˜ ë‚ ì”¨ & 7ì¼ ì˜ˆë³´ <span class="pill">Openâ€‘Meteo</span></h2>
    <div class="inputline">
      <label class="muted">ë„ì‹œ</label>
      <input id="city" placeholder="ì˜ˆ: Seoul" value="Seoul" />
      <button id="btnWeather">ì—…ë°ì´íŠ¸</button>
      <span class="muted">(ë¬´ë£Œ API, í‚¤ í•„ìš” ì—†ìŒ)</span>
    </div>
    <div id="weatherNow" class="row" style="gap:16px; align-items:baseline"></div>
    <ul id="weather7" class="list" style="margin-top:10px"></ul>
  </section>

  <section class="card">
    <h2>ğŸ”® ì˜¤ëŠ˜ì˜ ìš´ì„¸ (1985â€‘04â€‘18 ê¸°ì¤€)</h2>
    <div class="inputline">
      <label class="muted">ìƒì¼</label>
      <input id="birthday" type="date" />
      <button id="btnFortune">ìš´ì„¸ ë³´ê¸°</button>
      <span id="zodiacLabel" class="muted"></span>
    </div>
    <div id="fortune" style="font-size:15px; line-height:1.5"></div>
  </section>

  <section class="card" style="grid-column:1/-1">
    <h2>ğŸ“Š ì „ì¼ ì¢…ê°€ (ë¯¸êµ­/í•œêµ­) <span class="pill">ì˜µì…˜: Alpha Vantage í‚¤</span></h2>
    <div class="muted" style="margin-bottom:8px">ê¸°ë³¸ì€ ìœ„ì ¯(ì•„ë˜)ìœ¼ë¡œ ì°¨íŠ¸ë§Œ ì œê³µë©ë‹ˆë‹¤. ì „ì¼ ì¢…ê°€ í…ìŠ¤íŠ¸ í‘œì‹œëŠ” API í‚¤ í•„ìš”(ì˜µì…˜). í‚¤ ë¯¸ì„¤ì • ì‹œ ì•ˆë‚´ ë¬¸êµ¬ê°€ ë³´ì…ë‹ˆë‹¤.</div>
    <div class="kpi">
      <div class="tile"><div class="label">S&P 500 (ì „ì¼ì¢…ê°€)</div><div class="value" id="spxClose">í‚¤ í•„ìš”</div></div>
      <div class="tile"><div class="label">NASDAQ (ì „ì¼ì¢…ê°€)</div><div class="value" id="ixicClose">í‚¤ í•„ìš”</div></div>
      <div class="tile"><div class="label">Dow Jones (ì „ì¼ì¢…ê°€)</div><div class="value" id="djiClose">í‚¤ í•„ìš”</div></div>
      <div class="tile"><div class="label">KOSPI (ì „ì¼ì¢…ê°€)</div><div class="value" id="kospiClose">í‚¤ í•„ìš”</div></div>
    </div>
    <div class="muted" id="closeDate" style="margin-top:6px"></div>
  </section>

  <section class="card" style="grid-column:1/-1">
    <h2>ğŸ“ˆ ì§€ìˆ˜ ëª¨ë‹ˆí„° (ë¯¸êµ­/í•œêµ­) <span class="pill">TradingView ìœ„ì ¯</span></h2>
    <div class="tvwrap">
      <!-- TradingView Widget BEGIN -->
      <div class="tradingview-widget-container" style="height:400px">
        <div class="tradingview-widget-container__widget"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
        {
          "colorTheme": "dark",
          "dateRange": "1D",
          "showChart": true,
          "locale": "kr",
          "width": "100%",
          "height": "400",
          "largeChartUrl": "",
          "isTransparent": false,
          "showSymbolLogo": true,
          "plotLineColorGrowing": "#4ade80",
          "plotLineColorFalling": "#f87171",
          "gridLineColor": "rgba(255,255,255,0.06)",
          "scaleFontColor": "rgba(255,255,255,0.5)",
          "belowLineFillColorGrowing": "rgba(34,197,94,0.15)",
          "belowLineFillColorFalling": "rgba(248,113,113,0.15)",
          "symbolActiveColor": "rgba(56,189,248, 0.2)",
          "tabs": [
            {
              "title": "ë¯¸êµ­",
              "symbols": [
                {"s": "FOREXCOM:SPXUSD", "d": "S&P 500"},
                {"s": "NASDAQ:IXIC", "d": "NASDAQ"},
                {"s": "DJ:DJI", "d": "Dow Jones"}
              ]
            },
            {
              "title": "í•œêµ­",
              "symbols": [
                {"s": "KRX:KOSPI", "d": "KOSPI"},
                {"s": "KRX:KOSDAQ", "d": "KOSDAQ"}
              ]
            }
          ]
        }
        </script>
      </div>
      <!-- TradingView Widget END -->
    </div>
  </section>

  <section class="card">
    <h2>ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ì¦ì‹œ ì´ìŠˆ (í—¤ë“œë¼ì¸)</h2>
    <ul id="usStockNews" class="list"></ul>
    <div class="muted" style="margin-top:8px; font-size:12px">ê¸°ë³¸ì€ Google ë‰´ìŠ¤ ë§í¬. NewsAPI í‚¤ë¥¼ ë„£ìœ¼ë©´ ìë™ìœ¼ë¡œ ìµœì‹  5ê±´ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</div>
  </section>

  <section class="card">
    <h2>ğŸ’µ ë¯¸êµ­ ê²½ì œ ì´ìŠˆ í•œì¤„ ìš”ì•½</h2>
    <ul id="usEconNews" class="list"></ul>
  </section>

  <section class="card">
    <h2>ğŸ›ï¸ ë¯¸êµ­ ì •ì¹˜ ì´ìŠˆ í•œì¤„ ìš”ì•½</h2>
    <ul id="usPolNews" class="list"></ul>
  </section>

  <section class="card" style="grid-column:1/-1">
    <h2>ğŸ“° ë¯¸êµ­ ì¢…í•© ì´ìŠˆ & ê°•í‰</h2>
    <p id="usWrapSummary" class="muted" style="margin-bottom:8px">í—¤ë“œë¼ì¸ì„ ë°”íƒ•ìœ¼ë¡œ ìë™ ìš”ì•½(ì œëª© ê²°í•©) ë˜ëŠ” ìˆ˜ë™ ì½”ë©˜íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
    <div class="inputline">
      <input id="manualComment" placeholder="ì—¬ê¸°ì— ì˜¤ëŠ˜ì˜ ê°•í‰ì„ ì ì–´ë‘ë©´ ë¡œì»¬ ì €ì¥ë©ë‹ˆë‹¤." style="flex:1"/>
      <button id="saveComment">ì €ì¥</button>
    </div>
    <div id="commentSaved" class="muted"></div>
  </section>

  <section class="card" style="grid-column:1/-1">
    <h2>ğŸŒ ì„¸ê³„ ì´ìŠˆ (ì „ìŸÂ·ì •ì¹˜Â·ì—°ì˜ˆ ë“±)</h2>
    <ul id="worldNews" class="list"></ul>
  </section>

  <section class="card" style="grid-column:1/-1">
    <h2>ğŸ—£ï¸ ì˜ì–´ í•œë§ˆë”” (ë¬¸ì¥Â·ë²ˆì—­Â·ë¬¸ë²•Â·ë‹¨ì–´)</h2>
    <div id="engOne" class="list"></div>
  </section>
</div>

<footer class="foot">Â© <span id="year"></span> Daily Briefing â€” í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œë§Œ ì‚¬ìš©(ë¬´ë£Œ). í•„ìš” ì‹œ API í‚¤ë¥¼ ì¶”ê°€í•´ ìë™í™” ê°•í™”.</footer>

<script>
// ====== ê¸°ë³¸ ì„¤ì • ======
const CONFIG = {
  // ìœ„ì¹˜ ê¸°ë³¸ê°’ (ì„œìš¸)
  cityDefault: 'Seoul',
  // ì¢Œí‘œ ìºì‹œ (ê°„ë‹¨ ì§€ì˜¤ì½”ë”©)
  geoCache: {},
  // NewsAPI.org í‚¤ (ì„ íƒ, ì—†ìœ¼ë©´ RSS ë§í¬ë¡œ ëŒ€ì²´)
  NEWSAPI_KEY: '', // â† ìˆìœ¼ë©´ ë„£ìœ¼ì„¸ìš”
  // Alpha Vantage í‚¤ (ì„ íƒ: ì „ì¼ ì¢…ê°€ í…ìŠ¤íŠ¸ìš©)
  ALPHA_KEY: '', // â† ìˆìœ¼ë©´ ë„£ìœ¼ì„¸ìš”
  // ìƒì¼ (ìš´ì„¸ìš©)
  birthday: '1985-04-18'
};

// ====== ìœ í‹¸ ======
const $ = (q) => document.querySelector(q);
const todayKST = new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' });
$('#todayStr').textContent = `ëŒ€í•œë¯¼êµ­ í‘œì¤€ì‹œ â€” ${todayKST}`;
$('#year').textContent = new Date().getFullYear();

function fmtDate(d){
  return new Date(d).toLocaleDateString('ko-KR', { weekday:'short', month:'numeric', day:'numeric' });
}

// ====== ê°„ë‹¨ ì§€ì˜¤ì½”ë”© (Openâ€‘Meteo geocoding, ë¬´í‚¤) ======
async function geocode(city){
  if(CONFIG.geoCache[city]) return CONFIG.geoCache[city];
  const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=ko&format=json`;
  const r = await fetch(url); const j = await r.json();
  if(!j.results || !j.results.length) throw new Error('ë„ì‹œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
  const { latitude, longitude, name, country } = j.results[0];
  CONFIG.geoCache[city] = { latitude, longitude, name, country };
  return CONFIG.geoCache[city];
}

// ====== ë‚ ì”¨ (Openâ€‘Meteo, ë¬´í‚¤) ======
async function loadWeather(city){
  try{
    const g = await geocode(city);
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${g.latitude}&longitude=${g.longitude}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum&timezone=Asia%2FSeoul`;
    const r = await fetch(url); const j = await r.json();

    // í˜„ì¬
    const wmap = {0:'ë§‘ìŒ', 1:'ëŒ€ì²´ë¡œ ë§‘ìŒ', 2:'ë¶€ë¶„ íë¦¼', 3:'íë¦¼', 45:'ì•ˆê°œ', 48:'ì„œë¦¬ ì•ˆê°œ', 51:'ê°€ë²¼ìš´ ì´ìŠ¬ë¹„', 61:'ê°€ë²¼ìš´ ë¹„', 63:'ë³´í†µ ë¹„', 65:'ê°•í•œ ë¹„', 71:'ê°€ë²¼ìš´ ëˆˆ', 73:'ë³´í†µ ëˆˆ', 75:'ê°•í•œ ëˆˆ', 80:'ì†Œë‚˜ê¸°', 95:'ì²œë‘¥ë²ˆê°œ'};
    const c = j.current;
    $('#weatherNow').innerHTML = `
      <div class="tile"><div class="label">ì§€ì—­</div><div class="value">${g.name} (${g.country})</div></div>
      <div class="tile"><div class="label">í˜„ì¬ ê¸°ì˜¨</div><div class="value">${Math.round(c.temperature_2m)}Â°C</div></div>
      <div class="tile"><div class="label">ì²´ê°</div><div class="value">${Math.round(c.apparent_temperature)}Â°C</div></div>
      <div class="tile"><div class="label">ìŠµë„</div><div class="value">${c.relative_humidity_2m}%</div></div>
      <div class="tile"><div class="label">ë‚ ì”¨</div><div class="value">${wmap[c.weather_code] ?? 'â€”'}</div></div>
    `;

    // 7ì¼
    const d = j.daily;
    const items = d.time.map((t, i) => {
      return `<li>${fmtDate(t)} â€” ìµœê³  ${Math.round(d.temperature_2m_max[i])}Â° / ìµœì € ${Math.round(d.temperature_2m_min[i])}Â° Â· ê°•ìˆ˜ ${d.precipitation_sum[i]}mm Â· ${wmap[d.weather_code[i]] ?? ''}</li>`;
    }).join('');
    $('#weather7').innerHTML = items;
  }catch(e){ $('#weatherNow').textContent = 'ë‚ ì”¨ ë¡œë”© ì‹¤íŒ¨: ' + e.message }
}

$('#city').value = CONFIG.cityDefault;
$('#btnWeather').addEventListener('click', () => loadWeather($('#city').value.trim() || 'Seoul'));
loadWeather($('#city').value);

// ====== ìš´ì„¸ ======
function zodiacFromBirthday(ymd){
  const d = new Date(ymd);
  const m = d.getMonth()+1, day = d.getDate();
  const z = [
    ['capricorn',1,19,'ì—¼ì†Œìë¦¬'], ['aquarius',2,18,'ë¬¼ë³‘ìë¦¬'], ['pisces',3,20,'ë¬¼ê³ ê¸°ìë¦¬'],
    ['aries',4,19,'ì–‘ìë¦¬'], ['taurus',5,20,'í™©ì†Œìë¦¬'], ['gemini',6,21,'ìŒë‘¥ì´ìë¦¬'],
    ['cancer',7,22,'ê²Œìë¦¬'], ['leo',8,22,'ì‚¬ììë¦¬'], ['virgo',9,22,'ì²˜ë…€ìë¦¬'],
    ['libra',10,22,'ì²œì¹­ìë¦¬'], ['scorpio',11,22,'ì „ê°ˆìë¦¬'], ['sagittarius',12,21,'ì‚¬ìˆ˜ìë¦¬'], ['capricorn',12,31,'ì—¼ì†Œìë¦¬']
  ];
  let name='capricorn', label='ì—¼ì†Œìë¦¬';
  for(const [k, mm, dd, lab] of z){ if(m<mm || (m===mm && day<=dd)){ name=k; label=lab; break; } }
  return { name, label };
}

function seededPick(list, seedStr){
  // ê°„ë‹¨í•œ í•´ì‹œë¡œ ë‚ ì§œ+ë³„ìë¦¬ ê¸°ë°˜ ê²°ì •ì  ì„ íƒ
  let h=0; for(let i=0;i<seedStr.length;i++){ h = (h*31 + seedStr.charCodeAt(i))>>>0; }
  return list[h % list.length];
}

const fortunes = [
  'ì‘ì€ ì„ íƒì´ í° ê¸°íšŒë¥¼ ë¶€ë¦…ë‹ˆë‹¤.', 'ë§Œë‚¨ì´ í–‰ìš´ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.', 'ì •ë³´ê°€ í˜ì…ë‹ˆë‹¤. ë‰´ìŠ¤ë¥¼ ê°€ê¹Œì´ í•˜ì„¸ìš”.',
  'ì»¨ë””ì…˜ ì¡°ì ˆì— ì‹ ê²½ ì“°ë©´ ì„±ê³¼ê°€ í½ë‹ˆë‹¤.', 'í˜‘ì—…ì´ ë‹µì…ë‹ˆë‹¤. ì†ì„ ë‚´ë°€ì–´ ë³´ì„¸ìš”.', 'ê³¼ê°í•œ ì •ë¦¬ê°€ íš¨ìœ¨ì„ ë§Œë“­ë‹ˆë‹¤.',
  'ìƒˆë¡œìš´ ì œì•ˆì´ ë“¤ì–´ì˜µë‹ˆë‹¤. ì—´ë¦° ë§ˆìŒìœ¼ë¡œ.', 'ì§€ì¶œ ê´€ë¦¬ì— ì‹ ê²½ ì“°ë©´ ìˆ˜ìµì´ ì»¤ì§‘ë‹ˆë‹¤.', 'ì˜¤ëŠ˜ì˜ í‚¤ì›Œë“œ: íƒ€ì´ë°.'
];

function showFortune(){
  const b = CONFIG.birthday; // ê³ ì • ìƒì¼
  $('#birthday').value = CONFIG.birthday;
  const z = zodiacFromBirthday(b);
  $('#zodiacLabel').textContent = `(${z.label})`;
  const seed = new Date().toISOString().slice(0,10) + '|' + z.name; // ë‚ ì§œ+ë³„ìë¦¬
  $('#fortune').textContent = seededPick(fortunes, seed);
}
$('#btnFortune').addEventListener('click', showFortune);
showFortune();

// ====== ë‰´ìŠ¤ (ê¸°ë³¸: ë§í¬ / ì˜µì…˜: NewsAPI) ======
const googleNewsLinks = {
  usStock: [
    { t: 'ë¯¸êµ­ ì¦ì‹œ ì´ìŠˆ â€“ Google ë‰´ìŠ¤', u: 'https://news.google.com/search?q=US%20stock%20market&hl=en-US&gl=US&ceid=US:en' },
    { t: 'FOMC / ì—°ì¤€', u: 'https://news.google.com/search?q=FOMC%20Fed&hl=en-US&gl=US&ceid=US:en' },
    { t: 'NVIDIA / TSLA ì‹¤ì ', u: 'https://news.google.com/search?q=earnings%20NVIDIA%20TSLA&hl=en-US&gl=US&ceid=US:en' }
  ],
  usEconomy: [
    { t: 'ë¯¸êµ­ ê²½ì œ â€“ Google ë‰´ìŠ¤', u: 'https://news.google.com/search?q=US%20economy%20CPI%20jobs%20inflation&hl=en-US&gl=US&ceid=US:en' }
  ],
  usPolitics: [
    { t: 'ë¯¸êµ­ ì •ì¹˜ â€“ Google ë‰´ìŠ¤', u: 'https://news.google.com/search?q=US%20politics%20Congress%20White%20House&hl=en-US&gl=US&ceid=US:en' }
  ],
  world: [
    { t: 'ì„¸ê³„ ì´ìŠˆ â€“ Google ë‰´ìŠ¤', u: 'https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FtVnVLQUFQAQ?hl=ko&gl=KR&ceid=KR:ko' }
  ]
};

function renderLinkList(elId, arr){ $(elId).innerHTML = arr.map(x=>`<li><a href="${x.u}" target="_blank" rel="noopener">${x.t}</a></li>`).join(''); }
renderLinkList('#usStockNews', googleNewsLinks.usStock);
renderLinkList('#usEconNews', googleNewsLinks.usEconomy);
renderLinkList('#usPolNews', googleNewsLinks.usPolitics);
renderLinkList('#worldNews', googleNewsLinks.world);

// ì„ íƒì‚¬í•­: NewsAPIê°€ ìˆìœ¼ë©´ ì‹¤ì œ í—¤ë“œë¼ì¸ 5ê±´ì”© ë¶ˆëŸ¬ì˜¤ê¸°
async function tryNewsApi(q, el){
  if(!CONFIG.NEWSAPI_KEY) return; // í‚¤ ì—†ìœ¼ë©´ íŒ¨ìŠ¤
  try{
    const url = `https://newsapi.org/v2/everything?q=${encodeURIComponent(q)}&pageSize=5&language=en&sortBy=publishedAt&apiKey=${CONFIG.NEWSAPI_KEY}`;
    const r = await fetch(url); const j = await r.json();
    if(j.articles){
      el.innerHTML = j.articles.map(a => `<li><a href="${a.url}" target="_blank" rel="noopener">${a.title}</a> <span class="muted">â€” ${new Date(a.publishedAt).toLocaleString('ko-KR')}</span></li>`).join('');
    }
  }catch(e){ /* ë¬´ì‹œ: ë§í¬ ë¦¬ìŠ¤íŠ¸ê°€ ì´ë¯¸ ë Œë”ë¨ */ }
}
tryNewsApi('US stock market OR stocks', $('#usStockNews'));
tryNewsApi('US economy inflation jobs CPI PCE', $('#usEconNews'));
tryNewsApi('US politics Congress White House election', $('#usPolNews'));
tryNewsApi('global geopolitics war conflict entertainment', $('#worldNews'));

// ë¯¸êµ­ ì¢…í•© ìš”ì•½: ë‹¨ìˆœíˆ 3ê°œ ì„¹ì…˜ ì œëª© í•©ì³ í•œì¤„ ìš”ì•½ (ê°€ë²¼ìš´ ê¸°ë³¸ ë¡œì§)
function synthesizeSummary(){
  const pick = (ul)=>{ const li = ul.querySelector('li'); return li? li.textContent.replace(/\s+â€”.*/, '') : ''; };
  const s = pick($('#usStockNews'));
  const e = pick($('#usEconNews'));
  const p = pick($('#usPolNews'));
  const parts = [s,e,p].filter(Boolean);
  $('#usWrapSummary').textContent = parts.length ? `ìš”ì•½: ${parts.join(' Â· ')}` : 'ìš”ì•½: ìµœì‹  í—¤ë“œë¼ì¸ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.';
}
setTimeout(synthesizeSummary, 1000);

// ê°•í‰ ë¡œì»¬ ì €ì¥
const KEY='dailybrief_comment_'+new Date().toISOString().slice(0,10);
$('#saveComment').addEventListener('click', ()=>{
  localStorage.setItem(KEY, $('#manualComment').value.trim());
  $('#commentSaved').textContent = 'ì˜¤ëŠ˜ ê°•í‰ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ (ì´ ë¸Œë¼ìš°ì €ì—ì„œë§Œ).';
});
$('#manualComment').value = localStorage.getItem(KEY)||'';

// ====== ì „ì¼ ì¢…ê°€ (ì˜µì…˜: Alpha Vantage) ======
async function loadCloseIfKey(){
  if(!CONFIG.ALPHA_KEY){ return; }
  $('#spxClose').textContent = 'ë¡œë”©â€¦';
  $('#ixicClose').textContent = 'ë¡œë”©â€¦';
  $('#djiClose').textContent  = 'ë¡œë”©â€¦';
  $('#kospiClose').textContent= 'ë¡œë”©â€¦';
  const map = [
    { id:'#spxClose', sym:'^GSPC' },
    { id:'#ixicClose', sym:'^IXIC' },
    { id:'#djiClose',  sym:'^DJI'  },
    { id:'#kospiClose',sym:'^KS11' }
  ];
  // ë¹„ê³µì‹ ì‹¬ë³¼ì€ ì œê³µ ì•ˆ ë  ìˆ˜ ìˆìŒ. ì‹¤íŒ¨ ì‹œ ë¬¸êµ¬ ìœ ì§€.
  const fetchDaily = async (symbol)=>{
    const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${encodeURIComponent(symbol)}&apikey=${CONFIG.ALPHA_KEY}`;
    const r = await fetch(url); return r.json();
  };
  let dateShown = '';
  for(const it of map){
    try{
      const j = await fetchDaily(it.sym);
      const series = j['Time Series (Daily)'];
      if(series){
        const dates = Object.keys(series).sort().reverse();
        const d0 = dates[0];
        const close = series[d0]['4. close'];
        $(it.id).textContent = Number(close).toLocaleString('ko-KR');
        dateShown = d0;
      }
    }catch(_){ /* ë¬´ì‹œ */ }
  }
  if(dateShown){ $('#closeDate').textContent = `ê¸°ì¤€ì¼: ${dateShown}`; }
}
loadCloseIfKey();

// ====== ì˜ì–´ í•œë§ˆë””: ë¬¸ì¥Â·ë²ˆì—­Â·ë¬¸ë²•Â·ë‹¨ì–´ ======
const PHRASES = [
  { en: 'Keep your focus, and the rest will follow.', ko: 'ì§‘ì¤‘ì„ ìœ ì§€í•˜ë©´ ë‚˜ë¨¸ì§€ëŠ” ë”°ë¼ì˜µë‹ˆë‹¤.', grammar: 'ëª…ë ¹ë¬¸(ì£¼ì–´ ìƒëµ) + ë“±ìœ„ì ‘ì†ì‚¬ and + ë…ë¦½ì ˆ.', vocab: [ ['focus','ì§‘ì¤‘'], ['follow','ë”°ë¼ì˜¤ë‹¤'] ] },
  { en: 'Small steps compound into big gains.', ko: 'ì‘ì€ ê±¸ìŒì´ í° ì„±ê³¼ë¡œ ìŒ“ì…ë‹ˆë‹¤.', grammar: 'ì£¼ì–´ï¼‹ë™ì‚¬ï¼‹ì „ì¹˜ì‚¬êµ¬. compound into: ~ë¡œ ëˆ„ì ë˜ë‹¤.', vocab: [ ['compound into','~ë¡œ ëˆ„ì ë˜ë‹¤'], ['gain','ì´ìµ, ì„±ê³¼'] ] },
  { en: 'Make it simple, then make it better.', ko: 'ë¨¼ì € ë‹¨ìˆœí•˜ê²Œ, ê·¸ë‹¤ìŒ ë” ì¢‹ê²Œ ë§Œë“œì„¸ìš”.', grammar: 'ì—°ì†ëœ ëª…ë ¹ë¬¸. then: ì‹œê°„ì  ìˆœì„œ.', vocab: [ ['simple','ë‹¨ìˆœí•œ'], ['better','ë” ë‚˜ì€'] ] },
  { en: 'Preparation is the shortcut.', ko: 'ì¤€ë¹„ê°€ ê³§ ì§€ë¦„ê¸¸ì…ë‹ˆë‹¤.', grammar: 'ëª…ì‚¬ì ˆ S + be ë™ì‚¬ + ë³´ì–´.', vocab: [ ['preparation','ì¤€ë¹„'], ['shortcut','ì§€ë¦„ê¸¸'] ] },
  { en: 'Clarity beats speed when the stakes are high.', ko: 'ì¤‘ìš”í• ìˆ˜ë¡ ëª…í™•í•¨ì´ ì†ë„ë¥¼ ì´ê¹ë‹ˆë‹¤.', grammar: 'ë¶€ì‚¬ì ˆ when ~. ë³µí•©ëª…ì‚¬ stakes(ì¤‘ìš”ë„/íŒëˆ).', vocab: [ ['clarity','ëª…í™•ì„±'], ['stakes','ì¤‘ìš”ë„, ì´í•´ê´€ê³„'] ] },
  { en: 'Consistency turns effort into results.', ko: 'ì§€ì†ì„±ì´ ë…¸ë ¥ì„ ê²°ê³¼ë¡œ ë°”ê¿‰ë‹ˆë‹¤.', grammar: 'ì£¼ì–´ï¼‹ë™ì‚¬ï¼‹ëª©ì ì–´ï¼‹ì „ì¹˜ì‚¬êµ¬.', vocab: [ ['consistency','ì§€ì†ì„±'], ['turn A into B','Aë¥¼ Bë¡œ ë°”ê¾¸ë‹¤'] ] },
  { en: 'Ask better questions to get better answers.', ko: 'ë” ë‚˜ì€ ë‹µì„ ì›í•œë‹¤ë©´ ë” ë‚˜ì€ ì§ˆë¬¸ì„ í•˜ì„¸ìš”.', grammar: 'ë¶€ì •ì‚¬êµ¬ ëª©ì (ì˜ë„) í‘œí˜„.', vocab: [ ['question','ì§ˆë¬¸'], ['answer','ë‹µ'] ] }
];

function renderPhrase(){
  const today = new Date().toISOString().slice(0,10);
  const pick = seededPick(PHRASES, today);
  const vocabHtml = pick.vocab.map(([w,m]) => `<li>â€¢ <b>${w}</b>: ${m}</li>`).join('');
  $('#engOne').innerHTML = `
    <div class="tile">
      <div style="font-size:16px"><b>EN</b> â€” ${pick.en}</div>
      <div class="muted" style="margin-top:6px"><b>KO</b> â€” ${pick.ko}</div>
      <div style="margin-top:10px">
        <div class="muted"><b>ë¬¸ë²•</b></div>
        <div>${pick.grammar}</div>
      </div>
      <div style="margin-top:10px">
        <div class="muted"><b>ë‹¨ì–´</b></div>
        <ul class="list" style="margin-top:6px">${vocabHtml}</ul>
      </div>
    </div>`;
}
renderPhrase();

</script>
</body>
</html>
