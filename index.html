<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë°ì¼ë¦¬ ë¸Œë¦¬í•‘</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8; --accent:#38bdf8; }
    body { margin:0; font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif; background:var(--bg); color:var(--text);}
    header { padding:16px; border-bottom:1px solid #1f2937; background:#111827; position:sticky; top:0; z-index:10;}
    .nav { display:flex; gap:12px; align-items:center; }
    .nav a { color:var(--accent); text-decoration:none; font-size:14px }
    h1 { margin:0; font-size:22px; }
    .wrap { max-width:1100px; margin:0 auto; padding:20px; display:grid; gap:20px; }
    .card { background:var(--card); border:1px solid #1f2937; border-radius:16px; padding:16px;}
    .card h2 { margin:0 0 10px; font-size:18px;}
    .list { list-style:none; padding:0; margin:0;}
    .list li { padding:10px 0; border-bottom:1px dashed #334155;}
    .muted { color:var(--muted); font-size:13px;}
    .ko { color:#a5f3fc; font-size:13px; margin-top:4px;}
    .controls { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:8px 0 0; }
    button, input { padding:6px 10px; border-radius:8px; border:1px solid #334155; background:#1e293b; color:#e5e7eb; }
    .badge { display:inline-block; padding:2px 8px; border:1px solid #334155; border-radius:999px; font-size:12px; color:#93c5fd; margin-right:6px;}
  </style>
</head>
<body>
<header>
  <div class="nav">
    <h1>ë°ì¼ë¦¬ ë¸Œë¦¬í•‘</h1>
    <span style="flex:1"></span>
    <!-- ğŸ§ ë¦¬ìŠ¤ë‹ ë§í¬ ê³ ì • -->
    <a href="listening.html" id="listeningLink">ğŸ§ ì˜ì–´ ë¦¬ìŠ¤ë‹</a>
  </div>
  <div id="todayStr" class="muted"></div>
</header>

<div class="wrap">
  <!-- ë‚ ì”¨ -->
  <section class="card">
    <h2>â˜€ï¸ ì˜¤ëŠ˜ ë‚ ì”¨ & 7ì¼ ì˜ˆë³´</h2>
    <div class="controls">
      <label>ë„ì‹œ: <input id="city" value="Seoul"/></label>
      <button id="btnWeather">ì—…ë°ì´íŠ¸</button>
    </div>
    <div id="weatherNow" class="muted" style="margin-top:8px"></div>
    <ul id="weather7" class="list"></ul>
  </section>

  <!-- ìš´ì„¸ -->
  <section class="card">
    <h2>ğŸ”® ì˜¤ëŠ˜ì˜ ìš´ì„¸ (1985-04-18)</h2>
    <div id="fortune"></div>
  </section>

  <!-- ì¢…ê°€ -->
  <section class="card">
    <h2>ğŸ“Š ì „ì¼ ì¢…ê°€</h2>
    <div id="close" class="muted"></div>
  </section>

  <!-- ë‰´ìŠ¤ í—¤ë” -->
  <section class="card">
    <div style="display:flex; align-items:center; gap:10px;">
      <h2 style="margin:0">ğŸ“° ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤</h2>
      <span class="muted">(ì •ì¹˜ Â· ê²½ì œ Â· ì‚¬íšŒ Â· êµ­ì œ)</span>
      <span style="flex:1"></span>
      <button id="toggleMode">ìš”ì•½ í‘œì‹œ: í•œê¸€ë§Œ</button>
    </div>
  </section>

  <!-- ë‰´ìŠ¤ ì„¹ì…˜ -->
  <section class="card"><h2>ğŸ›ï¸ ì •ì¹˜</h2><ul id="politics" class="list"></ul></section>
  <section class="card"><h2>ğŸ’µ ê²½ì œ</h2><ul id="economy" class="list"></ul></section>
  <section class="card"><h2>ğŸ‘¥ ì‚¬íšŒ</h2><ul id="society" class="list"></ul></section>
  <section class="card"><h2>ğŸŒ êµ­ì œ</h2><ul id="world" class="list"></ul></section>

  <!-- ì¢…í•© ìš”ì•½ & ì‹œì‚¬ì  -->
  <section class="card">
    <h2>ğŸ“ ì¢…í•© ìš”ì•½</h2>
    <div id="wrapSummaryKo" class="ko" style="margin-bottom:6px"></div>
    <div id="wrapSummary" class="muted"></div>
    <h3 style="margin-top:12px">ğŸ“ˆ ë¯¸êµ­ ì£¼ì‹ íˆ¬ì ì‹œì‚¬ì </h3>
    <div id="investSummary"></div>
  </section>
</div>

<script>
// ê³µí†µ
const $=q=>document.querySelector(q);
$('#todayStr').textContent=new Date().toLocaleString('ko-KR');

// ìš´ì„¸(ê°„ë‹¨ ë¬¸êµ¬)
$('#fortune').textContent="ì˜¤ëŠ˜ì€ ê¸°íšŒê°€ ì°¾ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ë„ì „ì„ ë‘ë ¤ì›Œí•˜ì§€ ë§ˆì„¸ìš”.";

// ì¢…ê°€
async function loadClose(){
  try{
    const j=await fetch('data/close.json?ts='+Date.now()).then(r=>r.json());
    $('#close').textContent=`S&P500 ${j.values.SPX}, NASDAQ ${j.values.IXIC}, ë‹¤ìš° ${j.values.DJI}, ì½”ìŠ¤í”¼ ${j.values.KOSPI} (ê¸°ì¤€ì¼: ${j.date})`;
  }catch(e){$('#close').textContent='ë°ì´í„° ì—†ìŒ';}
}
loadClose();

// ë‚ ì”¨
const weatherMap={0:"ë§‘ìŒ",1:"ëŒ€ì²´ë¡œ ë§‘ìŒ",2:"ë¶€ë¶„ì ìœ¼ë¡œ íë¦¼",3:"íë¦¼",45:"ì•ˆê°œ",48:"ìƒì¸µì•ˆê°œ",
51:"ì´ìŠ¬ë¹„ ì•½í•¨",53:"ì´ìŠ¬ë¹„ ë³´í†µ",55:"ì´ìŠ¬ë¹„ ê°•í•¨",61:"ë¹„ ì•½í•¨",63:"ë¹„ ë³´í†µ",65:"ë¹„ ê°•í•¨",
71:"ëˆˆ ì•½í•¨",73:"ëˆˆ ë³´í†µ",75:"ëˆˆ ê°•í•¨",80:"ì†Œë‚˜ê¸° ì•½í•¨",81:"ì†Œë‚˜ê¸° ë³´í†µ",82:"ì†Œë‚˜ê¸° ê°•í•¨"};
async function loadWeather(city){
  try{
    const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=ko&format=json`).then(r=>r.json());
    const {latitude,longitude}=g.results[0];
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=Asia%2FSeoul`;
    const j=await fetch(url).then(r=>r.json());
    $('#weatherNow').textContent=`í˜„ì¬ ${j.current.temperature_2m}Â°C Â· ${weatherMap[j.current.weather_code]||''}`;
    $('#weather7').innerHTML=j.daily.time.map((t,i)=>
      `<li>${t}: ${j.daily.temperature_2m_max[i]}Â°/${j.daily.temperature_2m_min[i]}Â° Â· ${weatherMap[j.daily.weather_code[i]]||''}</li>`
    ).join('');
  }catch(e){$('#weatherNow').textContent='ë‚ ì”¨ ë¡œë”© ì‹¤íŒ¨';}
}
$('#btnWeather').onclick=()=>loadWeather($('#city').value);
loadWeather('Seoul');

// ===== ë¬´ë£Œ ë²ˆì—­ í•¨ìˆ˜ (google gtx) =====
async function translateKo(text){
  try{
    const r=await fetch("https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=ko&dt=t&q="+encodeURIComponent(text));
    const j=await r.json();
    return j[0].map(x=>x[0]).join('');
  }catch(e){ return ""; }
}

// ===== ë‰´ìŠ¤: í•œê¸€ë§Œ / ì˜ì–´+í•œê¸€ í† ê¸€ =====
let showMode = 'ko'; // 'ko' | 'both'
$('#toggleMode').addEventListener('click', ()=>{
  showMode = (showMode==='ko' ? 'both' : 'ko');
  $('#toggleMode').textContent = 'ìš”ì•½ í‘œì‹œ: ' + (showMode==='ko' ? 'í•œê¸€ë§Œ' : 'ì˜ì–´+í•œê¸€');
  loadNews(true);
});

async function renderItem(a){
  const en = a.summary || a.title || '';
  const ko = en ? await translateKo(en) : '';
  const whyKo = a.why_matters ? await translateKo(a.why_matters) : '';
  const nextKo = a.whats_next ? await translateKo(a.whats_next) : '';
  const kfig = (a.key_figures && a.key_figures.length) ? `<span class="badge">í•µì‹¬ ìˆ˜ì¹˜</span>${a.key_figures.join(', ')}` : '';

  return `
    <li>
      <a href="${a.url}" target="_blank">${a.title}</a>
      ${showMode==='both' && en ? `<div class="muted">${en}</div>`:''}
      ${ko ? `<div class="ko">${ko}</div>`:''}
      ${kfig ? `<div class="ko" style="margin-top:6px">${kfig}</div>`:''}
      ${whyKo ? `<div class="ko"><span class="badge">ì˜ë¯¸</span>${whyKo}</div>`:''}
      ${nextKo ? `<div class="ko"><span class="badge">ë‹¤ìŒ</span>${nextKo}</div>`:''}
    </li>`;
}

async function renderList(id, arr){
  if(!arr) return;
  const htmlParts=[];
  for(const a of arr){
    htmlParts.push(await renderItem(a));
  }
  $(id).innerHTML=htmlParts.join('');
}

let cachedNews = null;
async function loadNews(force=false){
  try{
    if(!cachedNews || force){
      cachedNews = await fetch('data/news.json?ts='+Date.now()).then(r=>r.json());
    }
    const j=cachedNews;
    await renderList('#politics', j.sections.politics);
    await renderList('#economy', j.sections.economy);
    await renderList('#society', j.sections.society);
    await renderList('#world',   j.sections.world);

    // ì¢…í•© ìš”ì•½: í•œêµ­ì–´ ìš°ì„ 
    const wrapEn = j.wrap_summary || '';
    const wrapKo = wrapEn ? await translateKo(wrapEn) : '';
    $('#wrapSummaryKo').textContent = wrapKo || 'ìš”ì•½ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
    $('#wrapSummary').textContent   = wrapEn ? `(ì˜ë¬¸) ${wrapEn}` : '';
    $('#investSummary').textContent = j.invest_summary || '';
  }catch(e){
    $('#wrapSummaryKo').textContent='ë‰´ìŠ¤ ë°ì´í„° ì—†ìŒ';
    $('#wrapSummary').textContent='';
  }
}
loadNews();
</script>
</body>
</html>
