<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Briefing</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8; --accent:#38bdf8; }
    body { margin:0; font-family:system-ui,sans-serif; background:var(--bg); color:var(--text);}
    header { padding:16px; border-bottom:1px solid #1f2937; background:#111827; position:sticky; top:0;}
    h1 { margin:0; font-size:22px; }
    .wrap { max-width:1100px; margin:0 auto; padding:20px; display:grid; gap:20px; }
    .card { background:var(--card); border:1px solid #1f2937; border-radius:16px; padding:16px;}
    .card h2 { margin:0 0 10px; font-size:18px;}
    .list { list-style:none; padding:0; margin:0;}
    .list li { padding:6px 0; border-bottom:1px dashed #334155;}
    .muted { color:var(--muted); font-size:13px;}
  </style>
</head>
<body>
<header>
  <h1>오늘의 브리핑</h1>
  <div id="todayStr" class="muted"></div>
</header>

<div class="wrap">
  <!-- 날씨 -->
  <section class="card">
    <h2>☀️ 오늘 날씨 & 7일 예보</h2>
    <input id="city" value="Seoul"/><button id="btnWeather">업데이트</button>
    <div id="weatherNow"></div>
    <ul id="weather7" class="list"></ul>
  </section>

  <!-- 운세 -->
  <section class="card">
    <h2>🔮 오늘의 운세 (1985-04-18)</h2>
    <div id="fortune"></div>
  </section>

  <!-- 종가 -->
  <section class="card">
    <h2>📊 전일 종가</h2>
    <div id="close"></div>
  </section>

  <!-- 뉴스 -->
  <section class="card">
    <h2>🏛️ 정치</h2><ul id="politics" class="list"></ul>
  </section>
  <section class="card">
    <h2>💵 경제</h2><ul id="economy" class="list"></ul>
  </section>
  <section class="card">
    <h2>👥 사회</h2><ul id="society" class="list"></ul>
  </section>
  <section class="card">
    <h2>🌍 국제</h2><ul id="world" class="list"></ul>
  </section>

  <section class="card">
    <h2>📝 종합 요약</h2>
    <div id="wrapSummary"></div>
    <h3>📈 투자 시사점</h3>
    <div id="investSummary"></div>
  </section>
</div>

<script>
// 공통
const $=q=>document.querySelector(q);
$('#todayStr').textContent=new Date().toLocaleString('ko-KR');

// 운세
$('#fortune').textContent="오늘은 기회가 찾아올 수 있습니다. 새로운 도전을 두려워하지 마세요.";

// 종가
async function loadClose(){
  try{
    const j=await fetch('data/close.json').then(r=>r.json());
    $('#close').textContent=`S&P500 ${j.values.SPX}, NASDAQ ${j.values.IXIC}, Dow ${j.values.DJI}, KOSPI ${j.values.KOSPI} (기준일: ${j.date})`;
  }catch(e){$('#close').textContent='데이터 없음';}
}
loadClose();

// 날씨
const weatherMap={0:"맑음",1:"대체로 맑음",2:"부분적으로 흐림",3:"흐림",45:"안개",48:"상층안개",
51:"이슬비 약함",53:"이슬비 보통",55:"이슬비 강함",61:"비 약함",63:"비 보통",65:"비 강함",
71:"눈 약함",73:"눈 보통",75:"눈 강함",80:"소나기 약함",81:"소나기 보통",82:"소나기 강함"};
async function loadWeather(city){
  try{
    const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&language=ko&format=json`).then(r=>r.json());
    const {latitude,longitude}=g.results[0];
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=Asia%2FSeoul`;
    const j=await fetch(url).then(r=>r.json());
    $('#weatherNow').textContent=`현재 ${j.current.temperature_2m}°C · ${weatherMap[j.current.weather_code]||''}`;
    $('#weather7').innerHTML=j.daily.time.map((t,i)=>
      `<li>${t}: ${j.daily.temperature_2m_max[i]}°/${j.daily.temperature_2m_min[i]}° · ${weatherMap[j.daily.weather_code[i]]||''}</li>`
    ).join('');
  }catch(e){$('#weatherNow').textContent='날씨 로딩 실패';}
}
$('#btnWeather').onclick=()=>loadWeather($('#city').value);
loadWeather('Seoul');

// 뉴스
async function loadNews(){
  try{
    const j=await fetch('data/news.json').then(r=>r.json());
    const render=(id,arr)=>$(id).innerHTML=arr.map(a=>`<li><a href="${a.url}" target="_blank">${a.title}</a><div class="muted">${a.summary}</div></li>`).join('');
    render('#politics',j.sections.politics);
    render('#economy',j.sections.economy);
    render('#society',j.sections.society);
    render('#world',j.sections.world);
    $('#wrapSummary').textContent=j.wrap_summary;
    $('#investSummary').textContent=j.invest_summary;
  }catch(e){$('#wrapSummary').textContent='뉴스 데이터 없음';}
}
loadNews();
</script>
</body>
</html>
