<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Briefing</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8; --accent:#38bdf8; }
    * { box-sizing:border-box }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Helvetica, Arial, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; background:var(--bg); color:var(--text); }
    header { padding:16px 20px; border-bottom:1px solid #1f2937; position:sticky; top:0; background:linear-gradient(180deg, rgba(15,23,42,.98), rgba(15,23,42,.92)); backdrop-filter: blur(6px); z-index:10; }
    .nav { display:flex; gap:12px; align-items:center; flex-wrap:wrap }
    .nav a { color:var(--accent); text-decoration:none; font-size:14px }
    h1 { margin:0; font-size:22px; letter-spacing:.3px; }
    .sub { color:var(--muted); font-size:13px; margin-top:4px }
    .wrap { max-width:1100px; margin:0 auto; padding:22px; display:grid; grid-template-columns: 1fr; gap:18px }
    @media (min-width: 980px) { .wrap { grid-template-columns: 1.1fr 1fr; } }
    .card { background:var(--card); border:1px solid #1f2937; border-radius:16px; padding:16px; box-shadow: 0 10px 24px rgba(0,0,0,.25); }
    .card h2 { margin:0 0 10px; font-size:18px; }
    .row { display:flex; gap:10px; flex-wrap:wrap }
    .muted { color:var(--muted); font-size:13px }
    .kpi { display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:10px }
    .kpi .tile { background:#0b1220; border:1px solid #1f2937; padding:10px 12px; border-radius:12px; }
    .tile .label { color:#9CA3AF; font-size:12px }
    .tile .value { font-size:16px; margin-top:4px }
    .list { list-style:none; padding:0; margin:0 }
    .list li { padding:8px 0; border-top:1px dashed #223046; }
    .list li:first-child { border-top:none }
    a { color: var(--accent); text-decoration:none }
    .pill { display:inline-block; padding:2px 8px; border:1px solid #334155; border-radius:999px; font-size:12px; color:#a5b4fc; }
    .tvwrap { border-radius:12px; overflow:hidden; border:1px solid #223046; }
    .eng { margin-top:10px; padding:10px; background:#0b1220; border-radius:10px }
    .eng .sentence { font-size:16px; margin-bottom:6px; }
    .eng .trans { color:#a5f3fc; font-size:14px; margin-bottom:6px; }
    .eng .grammar, .eng .vocab { color:#cbd5e1; font-size:13px; margin-bottom:4px; }
    footer { text-align:center; padding:16px; }
  </style>
</head>
<body>
<header>
  <div class="nav">
    <h1>오늘의 브리핑</h1>
    <span style="flex:1"></span>
    <a href="listening.html">영어 리스닝</a>
  </div>
  <div class="sub" id="todayStr">로딩 중…</div>
</header>

<div class="wrap">
  <!-- ☀️ 날씨 -->
  <section class="card">
    <h2>☀️ 오늘 날씨 & 7일 예보</h2>
    <input id="city" placeholder="도시" value="Seoul" />
    <button id="btnWeather">업데이트</button>
    <div id="weatherNow"></div>
    <ul id="weather7" class="list"></ul>
  </section>

  <!-- 🔮 운세 -->
  <section class="card">
    <h2>🔮 오늘의 운세 (1985-04-18)</h2>
    <div id="fortune"></div>
    <div id="zodiacLabel" class="muted"></div>
  </section>

  <!-- 📊 전일 종가 -->
  <section class="card" style="grid-column:1/-1">
    <h2>📊 전일 종가</h2>
    <div class="kpi">
      <div class="tile"><div class="label">S&P 500</div><div class="value" id="spxClose">-</div></div>
      <div class="tile"><div class="label">NASDAQ</div><div class="value" id="ixicClose">-</div></div>
      <div class="tile"><div class="label">Dow Jones</div><div class="value" id="djiClose">-</div></div>
      <div class="tile"><div class="label">KOSPI</div><div class="value" id="kospiClose">-</div></div>
    </div>
    <div class="muted" id="closeDate"></div>
  </section>

  <!-- 📈 차트 -->
  <section class="card" style="grid-column:1/-1">
    <h2>📈 지수 차트</h2>
    <div class="tvwrap">
      <div class="tradingview-widget-container" style="height:400px">
        <div class="tradingview-widget-container__widget"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
        {
          "colorTheme": "dark",
          "dateRange": "1D",
          "showChart": true,
          "locale": "ko",
          "width": "100%",
          "height": "400",
          "isTransparent": false,
          "showSymbolLogo": true,
          "tabs": [
            { "title": "미국", "symbols": [
              {"s":"FOREXCOM:SPXUSD","d":"S&P 500"},
              {"s":"NASDAQ:IXIC","d":"NASDAQ"},
              {"s":"DJ:DJI","d":"Dow Jones"} ] },
            { "title": "한국", "symbols": [
              {"s":"KRX:KOSPI","d":"KOSPI"},
              {"s":"KRX:KOSDAQ","d":"KOSDAQ"} ] }
          ]
        }
        </script>
      </div>
    </div>
  </section>

  <!-- 🇺🇸/🌍 뉴스 -->
  <section class="card"><h2>🇺🇸 미국 증시</h2><ul id="usStockNews" class="list"></ul></section>
  <section class="card"><h2>💵 미국 경제</h2><ul id="usEconNews" class="list"></ul></section>
  <section class="card"><h2>🏛️ 미국 정치</h2><ul id="usPolNews" class="list"></ul></section>
  <section class="card" style="grid-column:1/-1"><h2>🌍 세계 이슈</h2><ul id="worldNews" class="list"></ul></section>

  <!-- 🗣 영어 한마디 -->
  <section class="card" style="grid-column:1/-1">
    <h2>🗣 영어 한마디</h2>
    <div class="eng">
      <div class="sentence" id="engSentence"></div>
      <div class="trans" id="engTrans"></div>
      <div class="grammar" id="engGrammar"></div>
      <div class="vocab" id="engVocab"></div>
    </div>
  </section>
</div>

<footer class="sub">© <span id="year"></span> Daily Briefing</footer>

<script>
const CONFIG = { ALPHA_KEY:'', birthday:'1985-04-18' };
$('#todayStr').textContent = new Date().toLocaleString('ko-KR');
$('#year').textContent = new Date().getFullYear();
function $(q){return document.querySelector(q)}

// === 뉴스 요약: data/news.json 우선 ===
async function loadNews(){
  try{
    const r=await fetch('data/news.json?ts='+Date.now());
    if(r.ok){
      const j=await r.json(); const S=j.sections||{};
      const render=(id,arr)=>{ if(!arr) return;
        $(id).innerHTML=arr.map(a=>`<li><a href="${a.url}" target="_blank">${a.title}</a><div class="muted">${a.summary||''}</div></li>`).join('');
      };
      render('#usStockNews',S.us_stock);
      render('#usEconNews',S.us_econ);
      render('#usPolNews',S.us_politics);
      render('#worldNews',S.world);
      return;
    }
  }catch(e){}
  // 폴백: 구글뉴스 링크
  $('#usStockNews').innerHTML='<li><a href="https://news.google.com/search?q=US%20stock%20market">미국 증시 뉴스</a></li>';
  $('#usEconNews').innerHTML='<li><a href="https://news.google.com/search?q=US%20economy">미국 경제 뉴스</a></li>';
  $('#usPolNews').innerHTML='<li><a href="https://news.google.com/search?q=US%20politics">미국 정치 뉴스</a></li>';
  $('#worldNews').innerHTML='<li><a href="https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRFZxYUdjU0FtVnVLQUFQAQ">세계 뉴스</a></li>';
}
loadNews();

// === 운세
function zodiac(m,d){ if((m==4&&d<=19)||(m==3&&d>=21)) return '양자리'; return '기타자리'; }
$('#fortune').textContent='오늘은 좋은 기회가 올 수 있습니다.';
$('#zodiacLabel').textContent=zodiac(4,18);

// === 영어 한마디
const PHRASES=[{en:'Keep your focus, and the rest will follow.',ko:'집중하면 나머지는 따라온다.',grammar:'명령문+등위접속사',vocab:[['focus','집중'],['follow','따라오다']]}];
const pick=PHRASES[0];
$('#engSentence').textContent=pick.en;
$('#engTrans').textContent=pick.ko;
$('#engGrammar').textContent='문법: '+pick.grammar;
$('#engVocab').textContent='단어: '+pick.vocab.map(([w,m])=>`${w}(${m})`).join(', ');

// === 전일 종가 (JSON→Alpha)
async function loadClose(){
  try{
    const r=await fetch('data/close.json?ts='+Date.now());
    if(r.ok){const j=await r.json();
      $('#spxClose').textContent=j.values.SPX;
      $('#ixicClose').textContent=j.values.IXIC;
      $('#djiClose').textContent=j.values.DJI;
      $('#kospiClose').textContent=j.values.KOSPI;
      $('#closeDate').textContent='기준일: '+j.date;
      return;
    }
  }catch(e){}
  $('#closeDate').textContent='데이터 없음';
}
loadClose();

// === 날씨
async function loadWeather(city){
  try{
    const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&language=ko&format=json`).then(r=>r.json());
    const {latitude,longitude}=g.results[0];
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=Asia%2FSeoul`;
    const j=await fetch(url).then(r=>r.json());
    $('#weatherNow').textContent=`현재기온 ${j.current.temperature_2m}°C`;
    $('#weather7').innerHTML=j.daily.time.map((t,i)=>`<li>${t}: ${j.daily.temperature_2m_max[i]}° / ${j.daily.temperature_2m_min[i]}°</li>`).join('');
  }catch(e){$('#weatherNow').textContent='날씨 로딩 실패';}
}
$('#btnWeather').onclick=()=>loadWeather($('#city').value);
loadWeather('Seoul');
</script>
</body>
</html>
