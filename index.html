<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Daily Brief</title>
<link rel="icon" href="data:,">
<style>
  :root{
    --bg:#0b1220; --card:#121a2b; --text:#e6eefc; --sub:#91a4c7; --accent:#6aa0ff; --ok:#78e08f; --warn:#ffd166; --bad:#ff6b6b;
    --muted:#2a3450;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;background:var(--bg);color:var(--text);line-height:1.55}
  header{position:sticky;top:0;background:linear-gradient(180deg,#0b1220e6,#0b1220a0 60%,#0b122000);backdrop-filter:saturate(1.4) blur(6px);padding:16px 12px 8px;z-index:10}
  .wrap{max-width:1080px;margin:0 auto;padding:0 12px}
  h1{margin:0 0 8px;font-size:22px}
  .meta{font-size:13px;color:var(--sub)}
  .grid{display:grid;gap:12px;margin:12px 0}
  @media(min-width:900px){.grid{grid-template-columns:repeat(3,1fr)}}
  .card{background:var(--card);border:1px solid var(--muted);border-radius:14px;padding:14px}
  .card h2{margin:0 0 10px;font-size:18px}
  .list{margin:8px 0 0;padding:0;list-style:none}
  .list li{padding:8px 0;border-top:1px solid #243252}
  .list li:first-child{border-top:0}
  .muted{color:var(--sub)}
  a{color:var(--accent);text-decoration:none}
  a:hover{text-decoration:underline}
  .table{width:100%;border-collapse:collapse;margin-top:8px;font-size:14px}
  .table th,.table td{border:1px solid #263456;padding:6px 8px;text-align:center}
  .chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
  .chip{font-size:12px;border:1px solid #314066;border-radius:999px;padding:2px 8px;color:#b7c6e9}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  footer{padding:40px 12px;color:#8fa2c9;text-align:center}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .small{font-size:13px}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>ğŸ“Š Daily Brief</h1>
    <div class="meta" id="stamp">ë¡œë”© ì¤‘â€¦</div>
    <div class="row small">
      <a href="./listening.html">ğŸ§ ì˜ì–´ ë¦¬ìŠ¤ë‹</a>
      <span>Â·</span>
      <a href="https://github.com/hahabangga/dailybrief" target="_blank">ë ˆí¬ ì—´ê¸°</a>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- ë‚ ì”¨ -->
  <section class="card">
    <h2>â˜€ï¸ ì˜¤ëŠ˜ ë‚ ì”¨ & 7ì¼ ì „ë§ (ì„œìš¸)</h2>
    <div id="weatherNow" class="muted">ë¡œë”© ì¤‘â€¦</div>
    <div class="row small" id="todChunks"></div>
    <table class="table" id="wTable">
      <thead><tr><th>ë‚ ì§œ</th><th>ìµœê³ /ìµœì €</th><th>ìƒíƒœ</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- ë‰´ìŠ¤ -->
  <section class="card">
    <h2>ğŸ“° ë‰´ìŠ¤ (íˆ¬ì + ì‚¬íšŒ íŒŒê¸‰ë ¥)</h2>
    <div class="grid">
      <div>
        <h3>ğŸ‡ºğŸ‡¸ ë¯¸êµ­</h3>
        <ul id="us" class="list"></ul>
      </div>
      <div>
        <h3>ğŸ‡°ğŸ‡· í•œêµ­</h3>
        <ul id="kr" class="list"></ul>
      </div>
      <div>
        <h3>ğŸŒ ì„¸ê³„</h3>
        <ul id="world" class="list"></ul>
      </div>
    </div>
    <div><strong>ğŸ§­ ì˜¤ëŠ˜ì˜ í•µì‹¬ ê²°ê³¼</strong></div>
    <div id="wrapSummaryKo" class="muted">ìš”ì•½ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
    <div id="wrapSummary" class="small"></div>
  </section>

  <!-- ì¦ì‹œ -->
  <section class="card">
    <h2>ğŸ“ˆ ì „ì¼ ì¢…ê°€ & ì „ë§</h2>
    <div id="closes" class="row small muted">ë¡œë”© ì¤‘â€¦</div>
    <ul class="list" id="marketNotes"></ul>
    <div><strong>ğŸ’¡ íˆ¬ì ì¡°ì–¸</strong></div>
    <div id="investSummary" class="muted small"></div>
  </section>

  <!-- ìš´ì„¸ & ì˜ì–´ í•œ ë¬¸ì¥ -->
  <section class="card">
    <h2>ğŸ”® ìš´ì„¸ & ğŸ—£ ì˜ì–´ í•œ ë¬¸ì¥</h2>
    <div id="fortune" class="small"></div>
    <hr style="border:none;border-top:1px solid #243252;margin:12px 0">
    <div id="phrase" class="small"></div>
  </section>
</main>

<footer>
  <div>Â© Daily Brief â€” ìë™ìˆ˜ì§‘: Weather(Open-Meteo), News(Google News RSS ìš”ì•½), Close(Yahoo Finance via GitHub Actions)</div>
</footer>

<script>
/* ===== ê³µìš© ===== */
const $ = (q,root=document)=>root.querySelector(q);
const $$ = (q,root=document)=>[...root.querySelectorAll(q)];
$('#stamp').textContent = new Date().toLocaleString('ko-KR', { timeZone:'Asia/Seoul' });

async function translateKo(text){
  // ê°„ë‹¨ ë²ˆì—­(ë¬´ë£Œ gtx; í™˜ê²½ì— ë”°ë¼ CORSë¡œ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ â†’ ì‹¤íŒ¨ ì‹œ ì˜ì–´ ê·¸ëŒ€ë¡œ ë…¸ì¶œ)
  try{
    const url = 'https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=ko&dt=t&q=' + encodeURIComponent(text);
    const r = await fetch(url);
    const j = await r.json();
    return j[0].map(x=>x[0]).join('');
  }catch(e){
    return text; // ì‹¤íŒ¨ ì‹œ ì›ë¬¸ ë°˜í™˜
  }
}

function pct(v){ return (v>0?'+':'')+v.toFixed(2)+'%'; }
function chip(text){ const s=document.createElement('span'); s.className='chip'; s.textContent=text; return s; }

/* ===== ë‚ ì”¨: í˜„ì¬/7ì¼ + ì‹œê°„ëŒ€ë³„ ë©˜íŠ¸ ===== */
async function loadWeather(){
  try{
    // ì„œìš¸ ìœ„ê²½ë„
    const g = await fetch('https://geocoding-api.open-meteo.com/v1/search?name=Seoul&count=1&language=ko&format=json').then(r=>r.json());
    const { latitude:lat, longitude:lon } = g.results[0];
    // í˜„ì¬ + ì¼ë³„ + ì‹œê°„ë³„
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&timezone=Asia%2FSeoul&current=temperature_2m,apparent_temperature,weather_code&hourly=temperature_2m,apparent_temperature,precipitation_probability,wind_speed_10m,uv_index&daily=weather_code,temperature_2m_max,temperature_2m_min&forecast_days=7`;
    const w = await fetch(url).then(r=>r.json());

    // í˜„ì¬
    const nowT = Math.round(w.current.temperature_2m);
    const nowApp = Math.round(w.current.apparent_temperature);
    const nowSt = codeToText(w.current.weather_code);
    $('#weatherNow').textContent = `${fmtKST(new Date())}, ${nowT}Â°C (ì²´ê° ${nowApp}Â°C), ${nowSt}`;

    // ì‹œê°„ëŒ€ë³„ ë©˜íŠ¸
    const chunks = [
      {label:'ì˜¤ì „(06â€“12)',range:[6,12]},
      {label:'ì˜¤í›„(12â€“18)',range:[12,18]},
      {label:'ë°¤(18â€“24)',range:[18,24]},
    ];
    $('#todChunks').innerHTML='';
    for(const c of chunks){
      const hint = timeHint(w, c.range[0], c.range[1]);
      const tag = chip(`${c.label}: ${hint}`);
      $('#todChunks').appendChild(tag);
    }

    // 7ì¼ í‘œ
    const tb = $('#wTable tbody'); tb.innerHTML='';
    const days = w.daily.time;
    for(let i=0;i<days.length;i++){
      const d = days[i];
      const tr = document.createElement('tr');
      const hi = Math.round(w.daily.temperature_2m_max[i]);
      const lo = Math.round(w.daily.temperature_2m_min[i]);
      const st = codeToText(w.daily.weather_code[i]);
      tr.innerHTML = `<td>${d}</td><td>${hi}/${lo}Â°C</td><td>${st}</td>`;
      tb.appendChild(tr);
    }
  }catch(e){
    $('#weatherNow').textContent='(ë‚ ì”¨ ë°ì´í„° ì§€ì—°)';
  }
}
function fmtKST(d){ return d.toLocaleString('ko-KR',{timeZone:'Asia/Seoul', hour12:false}); }
function codeToText(code){
  // Open-Meteo WMO ë‚ ì”¨ ì½”ë“œ ê°„ë‹¨ ë§¤í•‘
  const m = {
    0:'ë§‘ìŒ',1:'ëŒ€ì²´ë¡œ ë§‘ìŒ',2:'ë¶€ë¶„ì  íë¦¼',3:'íë¦¼',
    45:'ì•ˆê°œ',48:'ì„œë¦¬ ì•ˆê°œ',
    51:'ì•½í•œ ì´ìŠ¬ë¹„',53:'ì´ìŠ¬ë¹„',55:'ê°•í•œ ì´ìŠ¬ë¹„',
    61:'ì•½í•œ ë¹„',63:'ë¹„',65:'ê°•í•œ ë¹„',
    66:'ì–¼ìŒë¹„',67:'ê°•í•œ ì–¼ìŒë¹„',
    71:'ì•½í•œ ëˆˆ',73:'ëˆˆ',75:'ê°•í•œ ëˆˆ',
    77:'ì§„ëˆˆê¹¨ë¹„',80:'ì†Œë‚˜ê¸°',81:'ê°•í•œ ì†Œë‚˜ê¸°',82:'ë§¤ìš° ê°•í•œ ì†Œë‚˜ê¸°',
    95:'ë‡Œìš°',96:'ë‡Œìš°(ìš°ë°•)',99:'ê°•í•œ ë‡Œìš°(ìš°ë°•)'
  };
  return m[code] || 'ë³€í™”';
}
function timeHint(w, hStart, hEnd){
  const hrs = w.hourly.time.map(t=>new Date(t));
  let pMax=0, uvMax=0, windMax=0, tFeelMax=-1e9, tFeelMin=1e9;
  for(let i=0;i<hrs.length;i++){
    const hh = hrs[i].toLocaleString('en-US',{timeZone:'Asia/Seoul', hour12:false}).split(', ')[1].split(':')[0]*1;
    if(hh>=hStart && hh<hEnd){
      pMax = Math.max(pMax, w.hourly.precipitation_probability?.[i]??0);
      uvMax = Math.max(uvMax, w.hourly.uv_index?.[i]??0);
      windMax = Math.max(windMax, w.hourly.wind_speed_10m?.[i]??0);
      const app = w.hourly.apparent_temperature?.[i];
      if(app!=null){ tFeelMax=Math.max(tFeelMax,app); tFeelMin=Math.min(tFeelMin,app); }
    }
  }
  const tips=[];
  if(pMax>=40) tips.push('ë¹„ ì†Œì§€(ìš°ì‚° ê¶Œì¥)');
  if(windMax>=8) tips.push('ê°•í’ ìœ ì˜');
  if(uvMax>=6) tips.push('ìì™¸ì„  ê°•í•¨(ì°¨ì–‘)');
  if(tFeelMax>=28) tips.push('ë”ìœ„ ì£¼ì˜');
  if(tFeelMin<=0) tips.push('í•œíŒŒ ìœ ì˜');
  return tips[0] ? tips.join(', ') : 'ëŒ€ì²´ë¡œ ë¬´ë‚œ';
}

/* ===== ë‰´ìŠ¤: regions.us/kr/world ì‚¬ìš© ===== */
let cachedNews=null;
async function loadNews(force=false){
  try{
    if(!cachedNews || force){
      cachedNews = await fetch('data/news.json?ts='+Date.now()).then(r=>r.json());
    }
    const j = cachedNews;

    // ìƒˆ êµ¬ì¡° ìš°ì„ 
    if(j.regions){
      await renderList('#us',    j.regions.us    || []);
      await renderList('#kr',    j.regions.kr    || []);
      await renderList('#world', j.regions.world || []);
    }else if(j.sections){
      // êµ¬ì¡° í˜¸í™˜(ì˜ˆì „ íŒŒì¼)
      await renderList('#us',    j.sections.economy  || []);
      await renderList('#kr',    j.sections.politics || []);
      await renderList('#world', j.sections.world    || j.sections.society || []);
    }else{
      $('#us').innerHTML = '<li>ë°ì´í„° ì—†ìŒ</li>';
      $('#kr').innerHTML = '<li>ë°ì´í„° ì—†ìŒ</li>';
      $('#world').innerHTML = '<li>ë°ì´í„° ì—†ìŒ</li>';
    }

    const wrapEn = j.wrap_summary || '';
    const wrapKo = wrapEn ? await translateKo(wrapEn) : '';
    $('#wrapSummaryKo').textContent = wrapKo || 'ìš”ì•½ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
    $('#wrapSummary').textContent   = wrapEn ? `(ì˜ë¬¸) ${wrapEn}` : '';

    // íˆ¬ì ì½”ë©˜íŠ¸ê°€ ìˆìœ¼ë©´ í‘œì‹œ
    $('#investSummary').textContent = j.invest_summary || 'ì‹œì¥ ë°©í–¥ì„± ë¶ˆí™•ì‹¤ â€” ë¶„ì‚°ê³¼ í˜„ê¸ˆë¹„ì¤‘ ê´€ë¦¬.';
  }catch(e){
    $('#wrapSummaryKo').textContent='ë‰´ìŠ¤ ë°ì´í„° ì—†ìŒ';
    $('#wrapSummary').textContent='';
  }
}

async function renderList(sel, arr){
  const el = $(sel);
  el.innerHTML = '';
  if(!arr || !arr.length){ el.innerHTML='<li class="muted">í•­ëª© ì—†ìŒ</li>'; return; }
  for(const it of arr.slice(0,5)){ // ê° ì§€ì—­ ìµœëŒ€ 5ê±´ í‘œì‹œ
    const li = document.createElement('li');
    const sum = it.summary || it.title || '';
    const why = it.why_matters ? `<div class="small muted">ì™œ ì¤‘ìš”í•œê°€: ${it.why_matters}</div>` : '';
    const when = it.published ? `<span class="muted small">${it.published}</span>` : '';
    li.innerHTML = `
      <div><a href="${it.url}" target="_blank">${escapeHtml(it.title||'ì œëª© ì—†ìŒ')}</a> ${when}</div>
      <div class="small">${escapeHtml(sum)}</div>
      ${why}
    `;
    el.appendChild(li);
  }
}
function escapeHtml(s){return (s||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}

/* ===== ì „ì¼ ì¢…ê°€ ===== */
async function loadCloses(){
  try{
    const j = await fetch('data/close.json?ts='+Date.now()).then(r=>r.json());
    const v = j.values || {};
    const d = j.date || '';
    const items = [
      ['S&P 500','SPX', v.SPX],
      ['Nasdaq','IXIC', v.IXIC],
      ['Dow','DJI', v.DJI],
      ['KOSPI','KOSPI', v.KOSPI],
    ];
    const row = $('#closes'); row.innerHTML='';
    row.append('ì „ì¼ ì¢…ê°€ ', d?`(${d})`:'', ' â€” ');
    items.forEach((x,i)=>{
      const [name,key,val]=x;
      const span = document.createElement('span');
      span.textContent = `${name}: ${val??'â€”'}`;
      if(i<items.length-1) span.textContent += ' Â· ';
      row.appendChild(span);
    });

    // ê°„ë‹¨ ë©”ëª¨(ì˜¤ëŠ˜/ì£¼ê°„/ì›”ê°„ ì „ë§ ìë¦¬)
    const ul = $('#marketNotes');
    ul.innerHTML = `
      <li><strong>ğŸ¯ ì˜¤ëŠ˜ ì „ë§</strong><div class="small muted">ì£¼ìš” ì´ë²¤íŠ¸/í—¤ë“œë¼ì¸ì— ë”°ë¼ ë³€ë™ì„± í™•ëŒ€ ê°€ëŠ¥.</div></li>
      <li><strong>ğŸ“… ì£¼ê°„ ì „ë§</strong><div class="small muted">CPI/FOMC/ì‹¤ì  ë“± ìº˜ë¦°ë” í™•ì¸.</div></li>
      <li><strong>ğŸ—“ ì›”ê°„ ì „ë§</strong><div class="small muted">ìœ ë™ì„±Â·ì •ì±… ë°©í–¥ê³¼ ëª¨ë©˜í…€ ì ê²€.</div></li>
    `;
  }catch(e){
    $('#closes').textContent='(ì¢…ê°€ ë°ì´í„° ì§€ì—°)';
  }
}

/* ===== ìš´ì„¸ & ì˜ì–´ í•œ ë¬¸ì¥ ===== */
function loadFortune(){
  const birth = new Date('1985-04-18T00:00:00+09:00');
  const today = new Date().toLocaleDateString('en-CA',{timeZone:'Asia/Seoul'});
  // ë§¤ìš° ê°„ë‹¨í•œ ê·œì¹™(ìš”ì¼/ë‹¬/ì¼ ê¸°ë°˜)
  const d = new Date();
  const seed = d.getFullYear()*10000 + (d.getMonth()+1)*100 + d.getDate();
  const r = (Math.sin(seed)+1)/2; // 0~1
  let msg = r>0.66?'ìƒˆë¡œìš´ ê¸°íšŒê°€ ì—´ë¦½ë‹ˆë‹¤. ë‹¨, ì„±ê¸‰í•œ ê²°ì •ì€ í”¼í•˜ì„¸ìš”.':
            r>0.33?'ì‹¤ì†ì„ ì±™ê¸¸ ë‚ . ì‘ì€ ì´ìµì„ ê¾¸ì¤€íˆ ëª¨ìœ¼ì„¸ìš”.':
                    'íœ´ì‹ê³¼ ì •ë¦¬ê°€ ë„ì›€ ë©ë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ ì§€ì¶œì„ ì¤„ì´ì„¸ìš”.';
  const tip = r>0.5?'íšŒì˜Â·ì†Œí†µì—ì„œ í•œ ë²ˆ ë” í™•ì¸í•˜ê¸°':'í˜„ê¸ˆíë¦„Â·ë¹„ìƒìê¸ˆ ì ê²€';
  $('#fortune').textContent = `ì˜¤ëŠ˜ì˜ ìš´ì„¸: ${msg} / í–‰ë™ íŒ: ${tip}`;
}

function loadPhrase(){
  // í•™ìŠµìš© ê°„ë‹¨ ë¬¸ì¥(ë§¤ì¼ ë‚ ì§œ ì‹œë“œë¡œ ìˆœí™˜)
  const bank = [
    ["Markets often overreact to headlines.","ì‹œì¥ë“¤ì€ ì¢…ì¢… í—¤ë“œë¼ì¸ì— ê³¼ë„ ë°˜ì‘í•œë‹¤.","overreact: ê³¼ì‰ ë°˜ì‘í•˜ë‹¤; headline: í—¤ë“œë¼ì¸","í˜„ì¬ì‹œì œ ì¼ë°˜ì§„ìˆ (ì£¼ì–´+ë™ì‚¬)"],
    ["Focus on risks you can control.","í†µì œ ê°€ëŠ¥í•œ ìœ„í—˜ì— ì§‘ì¤‘í•˜ë¼.","focus on: ~ì— ì§‘ì¤‘í•˜ë‹¤; risk: ìœ„í—˜; control: í†µì œ","ëª…ë ¹ë¬¸ + ì „ì¹˜ì‚¬êµ¬"],
    ["Cash is a position, not a mistake.","í˜„ê¸ˆ ë³´ìœ ë„ í•˜ë‚˜ì˜ í¬ì§€ì…˜ì´ì§€ ì‹¤ìˆ˜ê°€ ì•„ë‹ˆë‹¤.","position: í¬ì§€ì…˜; mistake: ì‹¤ìˆ˜","ë³´ì–´ ëª…ì‚¬êµ¬"],
    ["Volatility is the price of admission for returns.","ìˆ˜ìµì„ ìœ„í•œ ì…ì¥ë£Œê°€ ë°”ë¡œ ë³€ë™ì„±ì´ë‹¤.","volatility: ë³€ë™ì„±; return: ìˆ˜ìµ","ì „ì¹˜ì‚¬ for ëª©ì  ìš©ë²•"],
  ];
  const idx = new Date().getDate()%bank.length;
  const [en,ko,vo,gram] = bank[idx];
  $('#phrase').innerHTML = `
    <div><strong>ë¬¸ì¥:</strong> â€œ${en}â€</div>
    <div><strong>ë²ˆì—­:</strong> ${ko}</div>
    <div><strong>ë‹¨ì–´:</strong> ${vo}</div>
    <div><strong>ë¬¸ë²•:</strong> ${gram}</div>
  `;
}

/* ===== ë¶€íŒ… ===== */
(async function boot(){
  await Promise.all([
    loadWeather(),
    loadNews(),
    loadCloses()
  ]);
  loadFortune();
  loadPhrase();
})();
</script>
</body>
</html>
